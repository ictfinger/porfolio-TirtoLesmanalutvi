<!DOCTYPE html>
<html lang="id" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ“š Digital Library Pro | Sistem Manajemen Perpustakaan</title>

    <!-- SEO Meta Tags -->
    <meta name="description"
        content="Sistem manajemen perpustakaan digital modern dengan fitur lengkap untuk pengelolaan buku, peminjaman, dan statistik.">
    <meta name="keywords" content="perpustakaan digital, manajemen buku, sistem peminjaman, perpustakaan online">
    <meta name="author" content="Digital Library Pro">

    <!-- Bootstrap 5.3 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #7209b7;
            --success-color: #4cc9f0;
            --warning-color: #f72585;
            --danger-color: #ef4444;
            --dark-bg: #0a0a0a;
            --card-bg: #121212;
            --sidebar-bg: #1a1a1a;
            --gradient-primary: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            --gradient-secondary: linear-gradient(135deg, #7209b7 0%, #3a0ca3 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--dark-bg);
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            height: 100vh;
            background: var(--sidebar-bg);
            position: fixed;
            left: 0;
            top: 0;
            z-index: 1000;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: var(--gradient-primary);
            position: relative;
            overflow: hidden;
        }

        .sidebar-brand {
            display: flex;
            align-items: center;
            gap: 1rem;
            position: relative;
            z-index: 2;
        }

        .sidebar-brand i {
            font-size: 2rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.75rem;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .sidebar-brand h3 {
            font-weight: 800;
            margin: 0;
            font-size: 1.5rem;
            background: linear-gradient(135deg, #fff 0%, #cbd5e1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-link {
            padding: 1rem 1.5rem;
            color: #94a3b8;
            display: flex;
            align-items: center;
            gap: 1rem;
            font-weight: 500;
            border-radius: 12px;
            margin: 0.5rem 1rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-decoration: none;
            cursor: pointer;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            background: var(--gradient-primary);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .nav-link:hover,
        .nav-link.active {
            background: rgba(67, 97, 238, 0.1);
            color: #fff;
            transform: translateX(5px);
        }

        .nav-link.active::before {
            transform: translateX(0);
        }

        .nav-link i {
            font-size: 1.25rem;
            width: 24px;
        }

        .nav-badge {
            margin-left: auto;
            background: var(--gradient-primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            padding: 2rem;
            min-height: 100vh;
        }

        /* Header */
        .main-header {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title h1 {
            font-weight: 800;
            font-size: 1.8rem;
            margin: 0;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-title p {
            color: #94a3b8;
            margin: 0;
            font-size: 0.95rem;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
            box-shadow: 0 10px 30px rgba(67, 97, 238, 0.2);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin-bottom: 1rem;
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }

        .stat-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #94a3b8;
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Table Card */
        .table-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .card-title i {
            color: var(--primary-color);
        }

        /* Table Styling */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            color: #e2e8f0;
        }

        .data-table th {
            background: rgba(67, 97, 238, 0.1);
            color: #cbd5e1;
            font-weight: 600;
            padding: 1rem 1.25rem;
            text-align: left;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-table td {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            vertical-align: middle;
        }

        .data-table tbody tr {
            transition: all 0.2s ease;
        }

        .data-table tbody tr:hover {
            background: rgba(67, 97, 238, 0.05);
            transform: translateX(5px);
        }

        .data-table tbody tr:last-child td {
            border-bottom: none;
        }

        .status-badge {
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-available {
            background: rgba(76, 201, 240, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(76, 201, 240, 0.3);
        }

        .status-borrowed {
            background: rgba(247, 37, 133, 0.1);
            color: var(--warning-color);
            border: 1px solid rgba(247, 37, 133, 0.3);
        }

        .status-overdue {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .btn-action {
            padding: 0.5rem 1rem;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            min-width: 80px;
            justify-content: center;
        }

        .btn-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-edit {
            background: rgba(76, 201, 240, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(76, 201, 240, 0.3);
        }

        .btn-edit:hover {
            background: rgba(76, 201, 240, 0.2);
        }

        .btn-delete {
            background: rgba(247, 37, 133, 0.1);
            color: var(--warning-color);
            border: 1px solid rgba(247, 37, 133, 0.3);
        }

        .btn-delete:hover {
            background: rgba(247, 37, 133, 0.2);
        }

        .btn-borrow {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
            border: 1px solid rgba(67, 97, 238, 0.3);
        }

        .btn-borrow:hover {
            background: rgba(67, 97, 238, 0.2);
        }

        .btn-return {
            background: rgba(76, 201, 240, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(76, 201, 240, 0.3);
        }

        .btn-return:hover {
            background: rgba(76, 201, 240, 0.2);
        }

        .btn-detail {
            background: rgba(168, 85, 247, 0.1);
            color: #a855f7;
            border: 1px solid rgba(168, 85, 247, 0.3);
        }

        .btn-detail:hover {
            background: rgba(168, 85, 247, 0.2);
        }

        /* Modal */
        .modal-content {
            background: var(--card-bg);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1.5rem 2rem;
            background: var(--gradient-primary);
            border-radius: 20px 20px 0 0;
        }

        .modal-title {
            color: white;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-footer {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1.5rem 2rem;
        }

        /* Form Styling */
        .form-label {
            color: #cbd5e1;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .form-control {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--primary-color);
            color: white;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .form-control::placeholder {
            color: #64748b;
        }

        .form-control:disabled {
            background: rgba(255, 255, 255, 0.03);
            color: #64748b;
        }

        /* Buttons */
        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        /* Search Bar */
        .search-container {
            position: relative;
            max-width: 400px;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 3rem;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 0.95rem;
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
            font-size: 1.1rem;
        }

        /* Charts */
        .chart-container {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 2rem;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .chart-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin: 0;
        }

        /* Toast Notification */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: slideInRight 0.3s ease;
            min-width: 300px;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .toast-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .toast-success {
            border-left: 4px solid var(--success-color);
        }

        .toast-success .toast-icon {
            background: rgba(76, 201, 240, 0.2);
            color: var(--success-color);
        }

        .toast-error {
            border-left: 4px solid var(--warning-color);
        }

        .toast-error .toast-icon {
            background: rgba(247, 37, 133, 0.2);
            color: var(--warning-color);
        }

        .toast-info {
            border-left: 4px solid var(--primary-color);
        }

        .toast-info .toast-icon {
            background: rgba(67, 97, 238, 0.2);
            color: var(--primary-color);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #64748b;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .empty-state h4 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: #94a3b8;
        }

        /* Member Badge */
        .member-badge {
            padding: 0.3rem 0.75rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-student {
            background: rgba(76, 201, 240, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(76, 201, 240, 0.3);
        }

        .badge-teacher {
            background: rgba(168, 85, 247, 0.1);
            color: #a855f7;
            border: 1px solid rgba(168, 85, 247, 0.3);
        }

        .badge-staff {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }
        }

        /* Section Content */
        .section-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }

        .quick-action-btn {
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 200px;
        }

        .quick-action-btn:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
            box-shadow: 0 10px 30px rgba(67, 97, 238, 0.2);
        }

        .quick-action-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }

        /* Date Input Styling */
        input[type="date"] {
            color-scheme: dark;
        }

        /* Filter Section */
        .filter-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .filter-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #cbd5e1;
        }

        /* Tabs */
        .nav-tabs {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-tabs .nav-link {
            border: none;
            border-radius: 10px 10px 0 0;
            margin: 0;
            padding: 0.75rem 1.5rem;
        }

        .nav-tabs .nav-link.active {
            background: rgba(67, 97, 238, 0.1);
            border-bottom: 3px solid var(--primary-color);
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-brand">
                <i class="fas fa-book"></i>
                <div>
                    <h3>Digital Library</h3>
                    <p class="text-light mb-0 small opacity-75">Management System</p>
                </div>
            </div>
        </div>

        <nav class="nav flex-column mt-3">
            <a class="nav-link active" href="#" data-section="dashboard">
                <i class="fas fa-home"></i>
                Dashboard
                <span class="nav-badge" id="dashboardBadge">0</span>
            </a>
            <a class="nav-link" href="#" data-section="books">
                <i class="fas fa-book"></i>
                Manajemen Buku
                <span class="nav-badge" id="booksBadge">0</span>
            </a>
            <a class="nav-link" href="#" data-section="borrow">
                <i class="fas fa-sign-out-alt"></i>
                Peminjaman
                <span class="nav-badge" id="borrowBadge">0</span>
            </a>
            <a class="nav-link" href="#" data-section="return">
                <i class="fas fa-sign-in-alt"></i>
                Pengembalian
                <span class="nav-badge" id="returnBadge">0</span>
            </a>
            <a class="nav-link" href="#" data-section="members">
                <i class="fas fa-users"></i>
                Anggota
                <span class="nav-badge" id="membersBadge">0</span>
            </a>
            <a class="nav-link" href="#" data-section="reports">
                <i class="fas fa-chart-bar"></i>
                Laporan
            </a>
            <a class="nav-link" href="#" data-section="settings">
                <i class="fas fa-cog"></i>
                Pengaturan
            </a>
        </nav>

        <div class="mt-auto p-4 border-top border-dark">
            <div class="d-flex align-items-center">
                <div class="flex-shrink-0">
                    <img src="https://ui-avatars.com/api/?name=Admin&background=4361ee&color=fff" alt="Admin"
                        class="rounded-circle" width="40" height="40">
                </div>
                <div class="flex-grow-1 ms-3">
                    <h6 class="mb-0">Administrator</h6>
                    <small class="text-muted">Super Admin</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="main-header">
            <div class="header-title">
                <h1 id="pageTitle">ðŸ“Š Dashboard</h1>
                <p id="pageDescription">Selamat datang di sistem manajemen perpustakaan digital</p>
            </div>
            <div class="header-actions d-flex gap-3">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addBookModal">
                    <i class="fas fa-plus me-2"></i>Tambah Buku
                </button>
                <button class="btn btn-secondary" id="refreshBtn">
                    <i class="fas fa-sync-alt me-2"></i>Refresh
                </button>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div id="dashboard" class="section-content active">
            <!-- Quick Actions -->
            <div class="quick-actions">
                <div class="quick-action-btn" onclick="library.showSection('books')">
                    <div class="quick-action-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <div>
                        <h6 class="mb-1">Lihat Koleksi Buku</h6>
                        <small class="text-muted">Total <span id="quickTotalBooks">0</span> buku</small>
                    </div>
                </div>
                <div class="quick-action-btn" data-bs-toggle="modal" data-bs-target="#addBookModal">
                    <div class="quick-action-icon">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <div>
                        <h6 class="mb-1">Tambah Buku Baru</h6>
                        <small class="text-muted">Tambah buku ke koleksi</small>
                    </div>
                </div>
                <div class="quick-action-btn" onclick="library.showSection('borrow')">
                    <div class="quick-action-icon">
                        <i class="fas fa-handshake"></i>
                    </div>
                    <div>
                        <h6 class="mb-1">Proses Peminjaman</h6>
                        <small class="text-muted"><span id="quickAvailableBooks">0</span> buku tersedia</small>
                    </div>
                </div>
                <div class="quick-action-btn" onclick="library.showSection('members')">
                    <div class="quick-action-icon">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <div>
                        <h6 class="mb-1">Tambah Anggota</h6>
                        <small class="text-muted"><span id="quickActiveMembers">0</span> anggota aktif</small>
                    </div>
                </div>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="stat-content">
                        <div>
                            <div class="stat-number" id="totalBooks">0</div>
                            <div class="stat-label">Total Buku</div>
                        </div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <div class="stat-content">
                        <div>
                            <div class="stat-number" id="availableBooks">0</div>
                            <div class="stat-label">Buku Tersedia</div>
                        </div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-handshake"></i>
                    </div>
                    <div class="stat-content">
                        <div>
                            <div class="stat-number" id="borrowedBooks">0</div>
                            <div class="stat-label">Sedang Dipinjam</div>
                        </div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <div>
                            <div class="stat-number" id="activeMembers">0</div>
                            <div class="stat-label">Anggota Aktif</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="row">
                <div class="col-lg-8">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">ðŸ“ˆ Statistik Peminjaman Bulanan</h3>
                            <select class="form-select form-select-sm" style="width: auto;" id="chartPeriod">
                                <option value="monthly">Bulan Ini</option>
                                <option value="quarterly">3 Bulan Terakhir</option>
                                <option value="yearly">Tahun Ini</option>
                            </select>
                        </div>
                        <canvas id="borrowingChart"></canvas>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="chart-container">
                        <h3 class="chart-title mb-4">ðŸ“Š Kategori Buku</h3>
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Recent Transactions -->
            <div class="table-card">
                <div class="card-header">
                    <h4 class="card-title">
                        <i class="fas fa-history"></i>Transaksi Terbaru
                    </h4>
                    <a href="#" onclick="library.showSection('borrow')" class="btn btn-sm btn-secondary">Lihat Semua</a>
                </div>
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Anggota</th>
                                <th>Buku</th>
                                <th>Jenis</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="recentTransactions">
                            <!-- Data akan dimuat secara dinamis -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Books Management Content -->
        <div id="books" class="section-content">
            <div class="table-card">
                <div class="card-header">
                    <h4 class="card-title">
                        <i class="fas fa-books"></i>Daftar Buku
                    </h4>
                    <div class="d-flex gap-3">
                        <div class="search-container">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" id="bookSearch" placeholder="Cari buku...">
                        </div>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addBookModal">
                            <i class="fas fa-plus"></i> Buku Baru
                        </button>
                    </div>
                </div>
                <div class="filter-section">
                    <div class="row">
                        <div class="col-md-3">
                            <label class="form-label">Filter Kategori</label>
                            <select class="form-control" id="filterCategory">
                                <option value="">Semua Kategori</option>
                                <option value="Fiksi">Fiksi</option>
                                <option value="Non-Fiksi">Non-Fiksi</option>
                                <option value="Teknologi">Teknologi</option>
                                <option value="Sains">Sains</option>
                                <option value="Sejarah">Sejarah</option>
                                <option value="Sastra">Sastra</option>
                                <option value="Pendidikan">Pendidikan</option>
                                <option value="Agama">Agama</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Filter Status</label>
                            <select class="form-control" id="filterStatus">
                                <option value="">Semua Status</option>
                                <option value="available">Tersedia</option>
                                <option value="borrowed">Dipinjam</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Urutkan</label>
                            <select class="form-control" id="sortBooks">
                                <option value="title">Judul A-Z</option>
                                <option value="title_desc">Judul Z-A</option>
                                <option value="year">Tahun Terbit</option>
                                <option value="available">Stok Tersedia</option>
                            </select>
                        </div>
                        <div class="col-md-3 d-flex align-items-end">
                            <button class="btn btn-secondary w-100" id="resetFilters">
                                <i class="fas fa-redo me-2"></i>Reset Filter
                            </button>
                        </div>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Kode</th>
                                <th>Judul</th>
                                <th>Pengarang</th>
                                <th>Kategori</th>
                                <th>Tahun</th>
                                <th>Stok</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="booksTable">
                            <!-- Data buku akan dimuat di sini -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Borrow Content -->
        <div id="borrow" class="section-content">
            <div class="row">
                <div class="col-lg-5">
                    <div class="table-card">
                        <div class="card-header">
                            <h4 class="card-title">
                                <i class="fas fa-handshake"></i>Form Peminjaman
                            </h4>
                        </div>
                        <form id="borrowForm" class="p-3">
                            <div class="mb-3">
                                <label class="form-label">Pilih Buku</label>
                                <select class="form-control" id="borrowBookSelect" required>
                                    <option value="">-- Pilih Buku --</option>
                                </select>
                                <small class="text-muted">Hanya menampilkan buku yang tersedia</small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Pilih Anggota</label>
                                <select class="form-control" id="borrowMemberSelect" required>
                                    <option value="">-- Pilih Anggota --</option>
                                </select>
                                <small class="text-muted">Hanya anggota aktif yang dapat meminjam</small>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Tanggal Pinjam</label>
                                        <input type="date" class="form-control" id="borrowDate" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Tanggal Kembali</label>
                                        <input type="date" class="form-control" id="returnDate" required>
                                        <small class="text-muted">Maksimal 30 hari</small>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Catatan (Opsional)</label>
                                <textarea class="form-control" id="borrowNote" rows="2"
                                    placeholder="Catatan tambahan..."></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-check me-2"></i>Proses Peminjaman
                            </button>
                        </form>
                    </div>
                </div>
                <div class="col-lg-7">
                    <div class="table-card">
                        <div class="card-header">
                            <h4 class="card-title">
                                <i class="fas fa-list"></i>Riwayat Peminjaman Aktif
                            </h4>
                            <div class="search-container">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" class="search-input" id="borrowSearch"
                                    placeholder="Cari peminjaman...">
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Kode</th>
                                        <th>Anggota</th>
                                        <th>Buku</th>
                                        <th>Pinjam</th>
                                        <th>Kembali</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="borrowHistory">
                                    <!-- Data peminjaman akan dimuat di sini -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Return Content -->
        <div id="return" class="section-content">
            <div class="row">
                <div class="col-lg-4">
                    <div class="table-card">
                        <div class="card-header">
                            <h4 class="card-title">
                                <i class="fas fa-undo-alt"></i>Pengembalian Buku
                            </h4>
                        </div>
                        <form id="returnForm" class="p-3">
                            <div class="mb-3">
                                <label class="form-label">Kode Transaksi</label>
                                <input type="text" class="form-control" id="returnTransactionCode"
                                    placeholder="TRX-123456">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Atau Scan Barcode</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="returnBarcode"
                                        placeholder="Scan barcode buku">
                                    <button class="btn btn-secondary" type="button" id="scanBarcode">
                                        <i class="fas fa-camera"></i>
                                    </button>
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary w-100 mb-3" id="findTransaction">
                                <i class="fas fa-search me-2"></i>Cari Transaksi
                            </button>

                            <div id="transactionInfo" style="display: none;">
                                <div class="alert alert-info">
                                    <h6>Informasi Transaksi</h6>
                                    <p class="mb-1" id="transBookInfo"></p>
                                    <p class="mb-1" id="transMemberInfo"></p>
                                    <p class="mb-0" id="transDueInfo"></p>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Kondisi Buku</label>
                                    <select class="form-control" id="bookCondition">
                                        <option value="baik">Baik</option>
                                        <option value="rusak_ringan">Rusak Ringan</option>
                                        <option value="rusak_berat">Rusak Berat</option>
                                        <option value="hilang">Hilang</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Keterlambatan</label>
                                    <input type="text" class="form-control" id="lateDays" readonly>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Denda (Rp)</label>
                                    <input type="number" class="form-control" id="fineAmount" value="0">
                                </div>
                                <button type="submit" class="btn btn-success w-100">
                                    <i class="fas fa-check-circle me-2"></i>Proses Pengembalian
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="col-lg-8">
                    <div class="table-card">
                        <div class="card-header">
                            <h4 class="card-title">
                                <i class="fas fa-history"></i>Buku yang Harus Dikembalikan
                            </h4>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Kode</th>
                                        <th>Buku</th>
                                        <th>Anggota</th>
                                        <th>Tanggal Pinjam</th>
                                        <th>Jatuh Tempo</th>
                                        <th>Sisa Hari</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="dueBooksTable">
                                    <!-- Data buku yang harus dikembalikan -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Members Content -->
        <div id="members" class="section-content">
            <div class="row">
                <div class="col-lg-4">
                    <div class="table-card">
                        <div class="card-header">
                            <h4 class="card-title">
                                <i class="fas fa-user-plus"></i>Tambah Anggota Baru
                            </h4>
                        </div>
                        <form id="addMemberForm" class="p-3">
                            <div class="mb-3">
                                <label class="form-label">Kode Anggota</label>
                                <input type="text" class="form-control" id="memberCode" required placeholder="MEM-001">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Nama Lengkap</label>
                                <input type="text" class="form-control" id="memberName" required
                                    placeholder="Nama lengkap">
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-control" id="memberEmail" required
                                            placeholder="email@example.com">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Telepon</label>
                                        <input type="tel" class="form-control" id="memberPhone" required
                                            placeholder="081234567890">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Tipe Anggota</label>
                                        <select class="form-control" id="memberType" required>
                                            <option value="">Pilih Tipe</option>
                                            <option value="Mahasiswa">Mahasiswa</option>
                                            <option value="Dosen">Dosen</option>
                                            <option value="Staff">Staff</option>
                                            <option value="Umum">Umum</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Tanggal Bergabung</label>
                                        <input type="date" class="form-control" id="memberJoinDate" required>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-save me-2"></i>Simpan Anggota
                            </button>
                        </form>
                    </div>
                </div>
                <div class="col-lg-8">
                    <div class="table-card">
                        <div class="card-header">
                            <h4 class="card-title">
                                <i class="fas fa-users"></i>Daftar Anggota
                            </h4>
                            <div class="search-container">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" class="search-input" id="memberSearch" placeholder="Cari anggota...">
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Kode</th>
                                        <th>Nama</th>
                                        <th>Tipe</th>
                                        <th>Kontak</th>
                                        <th>Status</th>
                                        <th>Buku Dipinjam</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="membersTable">
                                    <!-- Data anggota akan dimuat di sini -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast Container -->
        <div class="toast-container" id="toastContainer"></div>
    </div>

    <!-- Add Book Modal -->
    <div class="modal fade" id="addBookModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-plus-circle me-2"></i>Tambah Buku Baru
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form id="addBookForm">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Kode Buku *</label>
                                    <input type="text" class="form-control" id="bookCode" required
                                        placeholder="LIB-001">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">ISBN</label>
                                    <input type="text" class="form-control" id="bookISBN"
                                        placeholder="978-3-16-148410-0">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Judul Buku *</label>
                            <input type="text" class="form-control" id="bookTitle" required
                                placeholder="Judul lengkap buku">
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Pengarang *</label>
                                    <input type="text" class="form-control" id="bookAuthor" required
                                        placeholder="Nama pengarang">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Penerbit</label>
                                    <input type="text" class="form-control" id="bookPublisher"
                                        placeholder="Nama penerbit">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Kategori *</label>
                                    <select class="form-control" id="bookCategory" required>
                                        <option value="">Pilih Kategori</option>
                                        <option value="Fiksi">Fiksi</option>
                                        <option value="Non-Fiksi">Non-Fiksi</option>
                                        <option value="Teknologi">Teknologi</option>
                                        <option value="Sains">Sains</option>
                                        <option value="Sejarah">Sejarah</option>
                                        <option value="Sastra">Sastra</option>
                                        <option value="Pendidikan">Pendidikan</option>
                                        <option value="Agama">Agama</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Tahun Terbit *</label>
                                    <input type="number" class="form-control" id="bookYear" required min="1900"
                                        max="2024" placeholder="2024">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Jumlah Stok *</label>
                                    <input type="number" class="form-control" id="bookStock" required min="1" value="1">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Deskripsi</label>
                            <textarea class="form-control" id="bookDescription" rows="3"
                                placeholder="Deskripsi singkat tentang buku"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="submit" class="btn btn-primary">Simpan Buku</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Book Modal -->
    <div class="modal fade" id="editBookModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-edit me-2"></i>Edit Buku
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form id="editBookForm">
                    <div class="modal-body">
                        <input type="hidden" id="editBookId">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Kode Buku *</label>
                                    <input type="text" class="form-control" id="editBookCode" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">ISBN</label>
                                    <input type="text" class="form-control" id="editBookISBN">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Judul Buku *</label>
                            <input type="text" class="form-control" id="editBookTitle" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Pengarang *</label>
                                    <input type="text" class="form-control" id="editBookAuthor" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Penerbit</label>
                                    <input type="text" class="form-control" id="editBookPublisher">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Kategori *</label>
                                    <select class="form-control" id="editBookCategory" required>
                                        <option value="Fiksi">Fiksi</option>
                                        <option value="Non-Fiksi">Non-Fiksi</option>
                                        <option value="Teknologi">Teknologi</option>
                                        <option value="Sains">Sains</option>
                                        <option value="Sejarah">Sejarah</option>
                                        <option value="Sastra">Sastra</option>
                                        <option value="Pendidikan">Pendidikan</option>
                                        <option value="Agama">Agama</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Tahun Terbit *</label>
                                    <input type="number" class="form-control" id="editBookYear" required min="1900"
                                        max="2024">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Jumlah Stok *</label>
                                    <input type="number" class="form-control" id="editBookStock" required min="1">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Deskripsi</label>
                            <textarea class="form-control" id="editBookDescription" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="submit" class="btn btn-primary">Update Buku</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Library Management System - Complete with All Button Logic
        class LibrarySystem {
            constructor() {
                this.books = JSON.parse(localStorage.getItem('libraryBooks')) || this.getInitialBooks();
                this.members = JSON.parse(localStorage.getItem('libraryMembers')) || this.getInitialMembers();
                this.transactions = JSON.parse(localStorage.getItem('libraryTransactions')) || [];
                this.currentEditId = null;
                this.currentTransaction = null;
                this.init();
            }

            getInitialBooks() {
                return [
                    {
                        id: 1,
                        code: 'LIB-001',
                        isbn: '978-3-16-148410-0',
                        title: 'Pemrograman Web Modern',
                        author: 'John Doe',
                        publisher: 'Tech Publishing',
                        category: 'Teknologi',
                        year: 2023,
                        stock: 5,
                        available: 5,
                        description: 'Buku pemrograman web untuk pemula hingga mahir'
                    },
                    {
                        id: 2,
                        code: 'LIB-002',
                        isbn: '978-1-23-456789-0',
                        title: 'Sejarah Indonesia Modern',
                        author: 'Jane Smith',
                        publisher: 'History Press',
                        category: 'Sejarah',
                        year: 2022,
                        stock: 3,
                        available: 2,
                        description: 'Sejarah Indonesia dari masa kemerdekaan hingga sekarang'
                    },
                    {
                        id: 3,
                        code: 'LIB-003',
                        isbn: '978-0-12-345678-9',
                        title: 'Kumpulan Puisi Modern',
                        author: 'Ahmad Yani',
                        publisher: 'Sastra Publishing',
                        category: 'Sastra',
                        year: 2021,
                        stock: 4,
                        available: 4,
                        description: 'Koleksi puisi modern dari berbagai penyair ternama'
                    }
                ];
            }

            getInitialMembers() {
                return [
                    {
                        id: 1,
                        code: 'MEM-001',
                        name: 'Budi Santoso',
                        email: 'budi@email.com',
                        phone: '081234567890',
                        type: 'Mahasiswa',
                        joinDate: '2024-01-15',
                        status: 'active',
                        borrowedBooks: 0
                    },
                    {
                        id: 2,
                        code: 'MEM-002',
                        name: 'Siti Rahayu',
                        email: 'siti@email.com',
                        phone: '081298765432',
                        type: 'Dosen',
                        joinDate: '2024-02-20',
                        status: 'active',
                        borrowedBooks: 0
                    }
                ];
            }

            init() {
                this.setupEventListeners();
                this.loadDashboard();
                this.loadBooks();
                this.loadBorrowForm();
                this.loadCharts();
                this.updateStatistics();
                this.setCurrentDate();
            }

            setupEventListeners() {
                // Navigation
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = link.getAttribute('data-section');
                        this.showSection(section);

                        // Update active nav
                        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                        link.classList.add('active');
                    });
                });

                // Add Book Form
                document.getElementById('addBookForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addBook();
                });

                // Edit Book Form
                document.getElementById('editBookForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.updateBook();
                });

                // Borrow Form
                document.getElementById('borrowForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.processBorrow();
                });

                // Return Form
                document.getElementById('returnForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.processReturn();
                });

                // Add Member Form
                document.getElementById('addMemberForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addMember();
                });

                // Search
                document.getElementById('bookSearch').addEventListener('input', (e) => {
                    this.searchBooks(e.target.value);
                });

                document.getElementById('borrowSearch').addEventListener('input', (e) => {
                    this.searchBorrowHistory(e.target.value);
                });

                document.getElementById('memberSearch').addEventListener('input', (e) => {
                    this.searchMembers(e.target.value);
                });

                // Filters
                document.getElementById('filterCategory').addEventListener('change', () => {
                    this.applyFilters();
                });

                document.getElementById('filterStatus').addEventListener('change', () => {
                    this.applyFilters();
                });

                document.getElementById('sortBooks').addEventListener('change', () => {
                    this.applyFilters();
                });

                document.getElementById('resetFilters').addEventListener('click', () => {
                    this.resetFilters();
                });

                // Refresh Button
                document.getElementById('refreshBtn').addEventListener('click', () => {
                    this.refreshData();
                });

                // Chart Period Change
                document.getElementById('chartPeriod').addEventListener('change', () => {
                    this.loadCharts();
                });

                // Find Transaction for Return
                document.getElementById('findTransaction').addEventListener('click', () => {
                    this.findTransaction();
                });

                // Scan Barcode
                document.getElementById('scanBarcode').addEventListener('click', () => {
                    this.scanBarcode();
                });

                // Initialize date for member join
                document.getElementById('memberJoinDate').valueAsDate = new Date();
            }

            showSection(section) {
                // Hide all sections
                document.querySelectorAll('.section-content').forEach(content => {
                    content.classList.remove('active');
                });

                // Show selected section
                const sectionEl = document.getElementById(section);
                if (sectionEl) {
                    sectionEl.classList.add('active');
                }

                // Update page title
                const titles = {
                    'dashboard': { title: 'ðŸ“Š Dashboard', desc: 'Selamat datang di sistem manajemen perpustakaan digital' },
                    'books': { title: 'ðŸ“š Manajemen Buku', desc: 'Kelola koleksi buku perpustakaan' },
                    'borrow': { title: 'ðŸ“– Peminjaman Buku', desc: 'Kelola peminjaman dan pengembalian buku' },
                    'return': { title: 'ðŸ”„ Pengembalian', desc: 'Proses pengembalian buku' },
                    'members': { title: 'ðŸ‘¥ Manajemen Anggota', desc: 'Kelola data anggota perpustakaan' },
                    'reports': { title: 'ðŸ“ˆ Laporan & Statistik', desc: 'Analisis data perpustakaan' },
                    'settings': { title: 'âš™ï¸ Pengaturan Sistem', desc: 'Konfigurasi sistem perpustakaan' }
                };

                if (titles[section]) {
                    document.getElementById('pageTitle').textContent = titles[section].title;
                    document.getElementById('pageDescription').textContent = titles[section].desc;
                }

                // Load section data
                switch (section) {
                    case 'books':
                        this.loadBooks();
                        break;
                    case 'borrow':
                        this.loadBorrowForm();
                        this.loadBorrowHistory();
                        break;
                    case 'return':
                        this.loadDueBooks();
                        break;
                    case 'members':
                        this.loadMembers();
                        break;
                }
            }

            loadDashboard() {
                this.loadRecentTransactions();
                this.updateStatistics();
                this.updateQuickStats();
            }

            loadBooks() {
                const tableBody = document.getElementById('booksTable');
                if (!tableBody) return;

                let filteredBooks = [...this.books];

                // Apply search filter
                const search = document.getElementById('bookSearch').value.toLowerCase();
                if (search) {
                    filteredBooks = filteredBooks.filter(book =>
                        book.code.toLowerCase().includes(search) ||
                        book.title.toLowerCase().includes(search) ||
                        book.author.toLowerCase().includes(search) ||
                        book.category.toLowerCase().includes(search)
                    );
                }

                // Apply category filter
                const categoryFilter = document.getElementById('filterCategory').value;
                if (categoryFilter) {
                    filteredBooks = filteredBooks.filter(book => book.category === categoryFilter);
                }

                // Apply status filter
                const statusFilter = document.getElementById('filterStatus').value;
                if (statusFilter === 'available') {
                    filteredBooks = filteredBooks.filter(book => book.available > 0);
                } else if (statusFilter === 'borrowed') {
                    filteredBooks = filteredBooks.filter(book => book.available === 0);
                }

                // Apply sorting
                const sortBy = document.getElementById('sortBooks').value;
                filteredBooks.sort((a, b) => {
                    switch (sortBy) {
                        case 'title':
                            return a.title.localeCompare(b.title);
                        case 'title_desc':
                            return b.title.localeCompare(a.title);
                        case 'year':
                            return b.year - a.year;
                        case 'available':
                            return b.available - a.available;
                        default:
                            return 0;
                    }
                });

                if (filteredBooks.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="8">
                                <div class="empty-state">
                                    <i class="fas fa-book"></i>
                                    <h4>Tidak ada buku ditemukan</h4>
                                    <p>Coba ubah filter pencarian Anda</p>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                tableBody.innerHTML = filteredBooks.map(book => `
                    <tr>
                        <td><strong>${book.code}</strong></td>
                        <td>
                            <div class="fw-bold">${book.title}</div>
                            <small class="text-muted">${book.author}</small>
                        </td>
                        <td>${book.author}</td>
                        <td><span class="badge bg-primary bg-opacity-25 text-primary">${book.category}</span></td>
                        <td>${book.year}</td>
                        <td>
                            <div class="d-flex align-items-center gap-2">
                                <div class="progress" style="width: 60px; height: 8px;">
                                    <div class="progress-bar bg-success" style="width: ${(book.available / book.stock) * 100}%"></div>
                                </div>
                                <span>${book.available}/${book.stock}</span>
                            </div>
                        </td>
                        <td>
                            <span class="status-badge ${book.available > 0 ? 'status-available' : 'status-borrowed'}">
                                <i class="fas fa-circle"></i>
                                ${book.available > 0 ? 'Tersedia' : 'Habis'}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-action btn-edit" onclick="library.editBook(${book.id})">
                                    <i class="fas fa-edit me-1"></i>Edit
                                </button>
                                <button class="btn-action btn-delete" onclick="library.deleteBook(${book.id})">
                                    <i class="fas fa-trash me-1"></i>Hapus
                                </button>
                                ${book.available > 0 ? `
                                    <button class="btn-action btn-borrow" onclick="library.prepareBorrow(${book.id})">
                                        <i class="fas fa-handshake me-1"></i>Pinjam
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `).join('');

                // Update books badge
                document.getElementById('booksBadge').textContent = this.books.length;
            }

            loadBorrowForm() {
                const bookSelect = document.getElementById('borrowBookSelect');
                const memberSelect = document.getElementById('borrowMemberSelect');

                // Populate book select
                bookSelect.innerHTML = '<option value="">-- Pilih Buku --</option>' +
                    this.books
                        .filter(book => book.available > 0)
                        .map(book => `<option value="${book.id}">${book.code} - ${book.title} (${book.available} tersedia)</option>`)
                        .join('');

                // Populate member select
                memberSelect.innerHTML = '<option value="">-- Pilih Anggota --</option>' +
                    this.members
                        .filter(member => member.status === 'active')
                        .map(member => `<option value="${member.id}">${member.code} - ${member.name}</option>`)
                        .join('');

                // Set dates
                this.setCurrentDate();
            }

            loadBorrowHistory() {
                const tableBody = document.getElementById('borrowHistory');
                if (!tableBody) return;

                let activeTransactions = this.transactions
                    .filter(transaction => !transaction.returned)
                    .reverse();

                // Apply search filter
                const search = document.getElementById('borrowSearch').value.toLowerCase();
                if (search) {
                    activeTransactions = activeTransactions.filter(transaction => {
                        const book = this.books.find(b => b.id == transaction.bookId);
                        const member = this.members.find(m => m.id == transaction.memberId);

                        return transaction.code.toLowerCase().includes(search) ||
                            (book && book.title.toLowerCase().includes(search)) ||
                            (member && member.name.toLowerCase().includes(search));
                    });
                }

                if (activeTransactions.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="7">
                                <div class="empty-state">
                                    <i class="fas fa-history"></i>
                                    <h4>Tidak ada peminjaman aktif</h4>
                                    <p>Semua buku telah dikembalikan</p>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                tableBody.innerHTML = activeTransactions.map(transaction => {
                    const book = this.books.find(b => b.id == transaction.bookId);
                    const member = this.members.find(m => m.id == transaction.memberId);
                    const isOverdue = new Date(transaction.dueDate) < new Date();

                    return `
                        <tr>
                            <td><strong>${transaction.code}</strong></td>
                            <td>${member?.name || 'Unknown'}</td>
                            <td>${book?.title || 'Unknown'}</td>
                            <td>${this.formatDate(transaction.borrowDate)}</td>
                            <td>${this.formatDate(transaction.dueDate)}</td>
                            <td>
                                <span class="status-badge ${isOverdue ? 'status-overdue' : 'status-borrowed'}">
                                    <i class="fas fa-circle"></i>
                                    ${isOverdue ? 'Terlambat' : 'Dipinjam'}
                                </span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-action btn-return" onclick="library.returnBookDirect(${transaction.id})">
                                        <i class="fas fa-undo me-1"></i>Kembalikan
                                    </button>
                                    <button class="btn-action btn-detail" onclick="library.showTransactionDetail(${transaction.id})">
                                        <i class="fas fa-info-circle me-1"></i>Detail
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');

                // Update borrow badge
                const activeBorrows = this.transactions.filter(t => !t.returned).length;
                document.getElementById('borrowBadge').textContent = activeBorrows;
            }

            loadRecentTransactions() {
                const tableBody = document.getElementById('recentTransactions');
                if (!tableBody) return;

                const recent = this.transactions.slice(-5).reverse();

                if (recent.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="6">
                                <div class="empty-state">
                                    <i class="fas fa-history"></i>
                                    <h4>Belum ada transaksi</h4>
                                    <p>Mulai proses peminjaman buku</p>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                tableBody.innerHTML = recent.map(transaction => {
                    const book = this.books.find(b => b.id == transaction.bookId);
                    const member = this.members.find(m => m.id == transaction.memberId);

                    return `
                        <tr>
                            <td>${this.formatDate(transaction.borrowDate)}</td>
                            <td>${member?.name || 'Unknown'}</td>
                            <td>${book?.title || 'Unknown'}</td>
                            <td>Peminjaman</td>
                            <td>
                                <span class="status-badge ${transaction.returned ? 'status-available' : 'status-borrowed'}">
                                    ${transaction.returned ? 'Selesai' : 'Aktif'}
                                </span>
                            </td>
                            <td>
                                <button class="btn-action btn-detail" onclick="library.showTransactionDetail(${transaction.id})">
                                    <i class="fas fa-eye me-1"></i>Lihat
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            loadDueBooks() {
                const tableBody = document.getElementById('dueBooksTable');
                if (!tableBody) return;

                const dueTransactions = this.transactions
                    .filter(transaction => !transaction.returned)
                    .sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));

                if (dueTransactions.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="7">
                                <div class="empty-state">
                                    <i class="fas fa-check-circle"></i>
                                    <h4>Tidak ada buku jatuh tempo</h4>
                                    <p>Semua buku sudah dikembalikan tepat waktu</p>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                tableBody.innerHTML = dueTransactions.map(transaction => {
                    const book = this.books.find(b => b.id == transaction.bookId);
                    const member = this.members.find(m => m.id == transaction.memberId);
                    const dueDate = new Date(transaction.dueDate);
                    const today = new Date();
                    const diffTime = dueDate - today;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                    return `
                        <tr>
                            <td><strong>${transaction.code}</strong></td>
                            <td>${book?.title || 'Unknown'}</td>
                            <td>${member?.name || 'Unknown'}</td>
                            <td>${this.formatDate(transaction.borrowDate)}</td>
                            <td>${this.formatDate(transaction.dueDate)}</td>
                            <td>
                                <span class="${diffDays < 0 ? 'text-danger' : diffDays <= 3 ? 'text-warning' : 'text-success'}">
                                    ${diffDays < 0 ? `${Math.abs(diffDays)} hari terlambat` : `${diffDays} hari lagi`}
                                </span>
                            </td>
                            <td>
                                <button class="btn-action btn-return" onclick="library.returnBookDirect(${transaction.id})">
                                    <i class="fas fa-undo me-1"></i>Kembalikan
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            loadMembers() {
                const tableBody = document.getElementById('membersTable');
                if (!tableBody) return;

                let filteredMembers = [...this.members];

                // Apply search filter
                const search = document.getElementById('memberSearch').value.toLowerCase();
                if (search) {
                    filteredMembers = filteredMembers.filter(member =>
                        member.code.toLowerCase().includes(search) ||
                        member.name.toLowerCase().includes(search) ||
                        member.email.toLowerCase().includes(search)
                    );
                }

                if (filteredMembers.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="7">
                                <div class="empty-state">
                                    <i class="fas fa-users"></i>
                                    <h4>Tidak ada anggota ditemukan</h4>
                                    <p>Tambahkan anggota baru</p>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                // Calculate borrowed books for each member
                filteredMembers.forEach(member => {
                    member.borrowedBooks = this.transactions.filter(
                        t => t.memberId === member.id && !t.returned
                    ).length;
                });

                tableBody.innerHTML = filteredMembers.map(member => `
                    <tr>
                        <td><strong>${member.code}</strong></td>
                        <td>${member.name}</td>
                        <td>
                            <span class="member-badge ${member.type === 'Mahasiswa' ? 'badge-student' : member.type === 'Dosen' ? 'badge-teacher' : 'badge-staff'}">
                                ${member.type}
                            </span>
                        </td>
                        <td>
                            <div>${member.email}</div>
                            <small class="text-muted">${member.phone}</small>
                        </td>
                        <td>
                            <span class="status-badge ${member.status === 'active' ? 'status-available' : 'status-borrowed'}">
                                ${member.status === 'active' ? 'Aktif' : 'Non-Aktif'}
                            </span>
                        </td>
                        <td>
                            <span class="${member.borrowedBooks > 0 ? 'text-warning fw-bold' : 'text-muted'}">
                                ${member.borrowedBooks} buku
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-action btn-edit" onclick="library.toggleMemberStatus(${member.id})">
                                    <i class="fas fa-power-off me-1"></i>
                                    ${member.status === 'active' ? 'Nonaktifkan' : 'Aktifkan'}
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');

                // Update members badge
                const activeMembers = this.members.filter(m => m.status === 'active').length;
                document.getElementById('membersBadge').textContent = activeMembers;
            }

            loadCharts() {
                // Borrowing Chart
                const borrowingCtx = document.getElementById('borrowingChart').getContext('2d');

                // Sample data
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
                const borrowData = [12, 19, 8, 15, 12, 15, 18, 16, 14, 17, 20, 22];
                const returnData = [10, 15, 6, 14, 10, 13, 15, 14, 12, 15, 18, 20];

                if (window.borrowingChart) {
                    window.borrowingChart.destroy();
                }

                window.borrowingChart = new Chart(borrowingCtx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [
                            {
                                label: 'Peminjaman',
                                data: borrowData,
                                borderColor: '#4361ee',
                                backgroundColor: 'rgba(67, 97, 238, 0.1)',
                                tension: 0.4,
                                fill: true
                            },
                            {
                                label: 'Pengembalian',
                                data: returnData,
                                borderColor: '#4cc9f0',
                                backgroundColor: 'rgba(76, 201, 240, 0.1)',
                                tension: 0.4,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#e2e8f0'
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: '#94a3b8'
                                }
                            },
                            y: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: '#94a3b8'
                                },
                                beginAtZero: true
                            }
                        }
                    }
                });

                // Category Chart
                const categoryCtx = document.getElementById('categoryChart').getContext('2d');

                const categories = [...new Set(this.books.map(book => book.category))];
                const categoryData = categories.map(category =>
                    this.books.filter(book => book.category === category).length
                );

                if (window.categoryChart) {
                    window.categoryChart.destroy();
                }

                window.categoryChart = new Chart(categoryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: categories,
                        datasets: [{
                            data: categoryData,
                            backgroundColor: [
                                '#4361ee',
                                '#3a0ca3',
                                '#7209b7',
                                '#4cc9f0',
                                '#f72585',
                                '#4895ef'
                            ],
                            borderWidth: 2,
                            borderColor: '#121212'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: '#e2e8f0',
                                    padding: 20
                                }
                            }
                        }
                    }
                });
            }

            addBook() {
                const form = document.getElementById('addBookForm');
                const formData = new FormData(form);

                const newBook = {
                    id: Date.now(),
                    code: formData.get('bookCode'),
                    isbn: formData.get('bookISBN'),
                    title: formData.get('bookTitle'),
                    author: formData.get('bookAuthor'),
                    publisher: formData.get('bookPublisher'),
                    category: formData.get('bookCategory'),
                    year: parseInt(formData.get('bookYear')),
                    stock: parseInt(formData.get('bookStock')),
                    available: parseInt(formData.get('bookStock')),
                    description: formData.get('bookDescription')
                };

                // Check if book code already exists
                if (this.books.some(book => book.code === newBook.code)) {
                    this.showToast('âŒ Kode buku sudah terdaftar!', 'error');
                    return;
                }

                this.books.push(newBook);
                this.saveData();
                this.loadBooks();
                this.updateStatistics();
                this.loadCharts();
                this.loadBorrowForm();

                // Close modal and reset form
                bootstrap.Modal.getInstance(document.getElementById('addBookModal')).hide();
                form.reset();

                this.showToast(`âœ… Buku "${newBook.title}" berhasil ditambahkan!`, 'success');
            }

            editBook(bookId) {
                const book = this.books.find(b => b.id === bookId);
                if (!book) return;

                this.currentEditId = bookId;

                // Fill edit form
                document.getElementById('editBookId').value = book.id;
                document.getElementById('editBookCode').value = book.code;
                document.getElementById('editBookISBN').value = book.isbn || '';
                document.getElementById('editBookTitle').value = book.title;
                document.getElementById('editBookAuthor').value = book.author;
                document.getElementById('editBookPublisher').value = book.publisher || '';
                document.getElementById('editBookCategory').value = book.category;
                document.getElementById('editBookYear').value = book.year;
                document.getElementById('editBookStock').value = book.stock;
                document.getElementById('editBookDescription').value = book.description || '';

                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('editBookModal'));
                modal.show();
            }

            updateBook() {
                const bookId = parseInt(document.getElementById('editBookId').value);
                const bookIndex = this.books.findIndex(b => b.id === bookId);

                if (bookIndex === -1) return;

                const oldBook = this.books[bookIndex];
                const newStock = parseInt(document.getElementById('editBookStock').value);
                const stockDifference = newStock - oldBook.stock;

                this.books[bookIndex] = {
                    ...oldBook,
                    code: document.getElementById('editBookCode').value,
                    isbn: document.getElementById('editBookISBN').value,
                    title: document.getElementById('editBookTitle').value,
                    author: document.getElementById('editBookAuthor').value,
                    publisher: document.getElementById('editBookPublisher').value,
                    category: document.getElementById('editBookCategory').value,
                    year: parseInt(document.getElementById('editBookYear').value),
                    stock: newStock,
                    available: Math.max(0, oldBook.available + stockDifference),
                    description: document.getElementById('editBookDescription').value
                };

                this.saveData();
                this.loadBooks();
                this.updateStatistics();
                this.loadCharts();
                this.loadBorrowForm();

                bootstrap.Modal.getInstance(document.getElementById('editBookModal')).hide();
                this.showToast(`âœ… Buku "${this.books[bookIndex].title}" berhasil diperbarui!`, 'success');
            }

            deleteBook(bookId) {
                if (!confirm('Apakah Anda yakin ingin menghapus buku ini?')) return;

                const book = this.books.find(b => b.id === bookId);
                if (!book) return;

                // Check if book is currently borrowed
                const activeBorrows = this.transactions.filter(t =>
                    t.bookId === bookId && !t.returned
                );

                if (activeBorrows.length > 0) {
                    this.showToast('âŒ Tidak bisa menghapus buku yang sedang dipinjam!', 'error');
                    return;
                }

                this.books = this.books.filter(b => b.id !== bookId);
                this.saveData();
                this.loadBooks();
                this.updateStatistics();
                this.loadCharts();
                this.loadBorrowForm();

                this.showToast('âœ… Buku berhasil dihapus!', 'success');
            }

            prepareBorrow(bookId) {
                const book = this.books.find(b => b.id === bookId);
                if (!book || book.available <= 0) return;

                // Switch to borrow section
                this.showSection('borrow');

                // Set book in select
                setTimeout(() => {
                    document.getElementById('borrowBookSelect').value = bookId;
                    document.getElementById('borrowMemberSelect').focus();
                }, 100);
            }

            processBorrow() {
                const bookId = parseInt(document.getElementById('borrowBookSelect').value);
                const memberId = parseInt(document.getElementById('borrowMemberSelect').value);
                const borrowDate = document.getElementById('borrowDate').value;
                const dueDate = document.getElementById('returnDate').value;
                const note = document.getElementById('borrowNote').value;

                const book = this.books.find(b => b.id === bookId);
                const member = this.members.find(m => m.id === memberId);

                if (!book || !member) {
                    this.showToast('âŒ Data tidak valid!', 'error');
                    return;
                }

                if (book.available <= 0) {
                    this.showToast('âŒ Buku tidak tersedia!', 'error');
                    return;
                }

                if (member.status !== 'active') {
                    this.showToast('âŒ Anggota tidak aktif!', 'error');
                    return;
                }

                // Check if member has reached borrowing limit
                const memberBorrowed = this.transactions.filter(t =>
                    t.memberId === memberId && !t.returned
                ).length;

                if (memberBorrowed >= 5) {
                    this.showToast('âŒ Anggota telah mencapai batas peminjaman (5 buku)!', 'error');
                    return;
                }

                // Check for overdue books
                const overdueBooks = this.transactions.filter(t =>
                    t.memberId === memberId &&
                    !t.returned &&
                    new Date(t.dueDate) < new Date()
                );

                if (overdueBooks.length > 0) {
                    if (!confirm('âš ï¸ Anggota memiliki buku yang terlambat dikembalikan. Lanjutkan peminjaman?')) {
                        return;
                    }
                }

                // Update book availability
                book.available -= 1;

                // Update member borrowed count
                member.borrowedBooks = (member.borrowedBooks || 0) + 1;

                // Create transaction
                const transaction = {
                    id: Date.now(),
                    code: `TRX-${Date.now().toString().slice(-6)}`,
                    bookId: bookId,
                    memberId: memberId,
                    borrowDate: borrowDate,
                    dueDate: dueDate,
                    returned: false,
                    returnDate: null,
                    note: note,
                    fine: 0,
                    condition: null
                };

                this.transactions.push(transaction);

                this.saveData();
                this.loadBooks();
                this.loadBorrowHistory();
                this.loadRecentTransactions();
                this.loadDueBooks();
                this.updateStatistics();
                this.loadBorrowForm();

                // Reset form
                document.getElementById('borrowForm').reset();
                this.setCurrentDate();

                this.showToast(`âœ… Buku "${book.title}" berhasil dipinjam oleh ${member.name}!`, 'success');
            }

            findTransaction() {
                const code = document.getElementById('returnTransactionCode').value.trim();
                const barcode = document.getElementById('returnBarcode').value.trim();

                let transaction = null;

                if (code) {
                    transaction = this.transactions.find(t => t.code === code && !t.returned);
                } else if (barcode) {
                    // Find by book code (simulated barcode)
                    const book = this.books.find(b => b.code === barcode);
                    if (book) {
                        transaction = this.transactions.find(t =>
                            t.bookId === book.id && !t.returned
                        );
                    }
                }

                if (!transaction) {
                    this.showToast('âŒ Transaksi tidak ditemukan atau buku sudah dikembalikan!', 'error');
                    document.getElementById('transactionInfo').style.display = 'none';
                    return;
                }

                this.currentTransaction = transaction;

                const book = this.books.find(b => b.id == transaction.bookId);
                const member = this.members.find(m => m.id == transaction.memberId);
                const dueDate = new Date(transaction.dueDate);
                const today = new Date();
                const lateDays = Math.max(0, Math.ceil((today - dueDate) / (1000 * 60 * 60 * 24)));

                // Calculate fine (Rp 2000 per day)
                const fineAmount = lateDays > 0 ? lateDays * 2000 : 0;

                // Update info display
                document.getElementById('transBookInfo').textContent = `Buku: ${book.title}`;
                document.getElementById('transMemberInfo').textContent = `Peminjam: ${member.name}`;
                document.getElementById('transDueInfo').textContent = `Jatuh Tempo: ${this.formatDate(transaction.dueDate)}`;
                document.getElementById('lateDays').value = `${lateDays} hari`;
                document.getElementById('fineAmount').value = fineAmount;

                // Show transaction info
                document.getElementById('transactionInfo').style.display = 'block';
            }

            processReturn() {
                if (!this.currentTransaction) {
                    this.showToast('âŒ Tidak ada transaksi yang dipilih!', 'error');
                    return;
                }

                const condition = document.getElementById('bookCondition').value;
                const fineAmount = parseInt(document.getElementById('fineAmount').value) || 0;

                const transactionIndex = this.transactions.findIndex(t => t.id === this.currentTransaction.id);
                if (transactionIndex === -1) return;

                // Update transaction
                this.transactions[transactionIndex].returned = true;
                this.transactions[transactionIndex].returnDate = new Date().toISOString().split('T')[0];
                this.transactions[transactionIndex].condition = condition;
                this.transactions[transactionIndex].fine = fineAmount;

                // Update book availability
                const bookId = this.transactions[transactionIndex].bookId;
                const bookIndex = this.books.findIndex(b => b.id === bookId);

                if (bookIndex !== -1) {
                    this.books[bookIndex].available += 1;
                }

                // Update member borrowed count
                const memberId = this.transactions[transactionIndex].memberId;
                const memberIndex = this.members.findIndex(m => m.id === memberId);
                if (memberIndex !== -1) {
                    this.members[memberIndex].borrowedBooks = Math.max(0, (this.members[memberIndex].borrowedBooks || 0) - 1);
                }

                this.saveData();
                this.loadBooks();
                this.loadBorrowHistory();
                this.loadRecentTransactions();
                this.loadDueBooks();
                this.updateStatistics();
                this.loadMembers();

                // Reset form
                document.getElementById('returnForm').reset();
                document.getElementById('transactionInfo').style.display = 'none';
                this.currentTransaction = null;

                this.showToast(`âœ… Buku berhasil dikembalikan! ${fineAmount > 0 ? `Denda: Rp ${fineAmount.toLocaleString()}` : ''}`, 'success');
            }

            returnBookDirect(transactionId) {
                const transaction = this.transactions.find(t => t.id === transactionId);
                if (!transaction) return;

                this.currentTransaction = transaction;

                // Auto-fill return form
                document.getElementById('returnTransactionCode').value = transaction.code;

                // Switch to return section
                this.showSection('return');

                // Trigger find transaction
                setTimeout(() => {
                    document.getElementById('findTransaction').click();
                }, 300);
            }

            addMember() {
                const form = document.getElementById('addMemberForm');
                const formData = new FormData(form);

                const newMember = {
                    id: Date.now(),
                    code: formData.get('memberCode'),
                    name: formData.get('memberName'),
                    email: formData.get('memberEmail'),
                    phone: formData.get('memberPhone'),
                    type: formData.get('memberType'),
                    joinDate: formData.get('memberJoinDate'),
                    status: 'active',
                    borrowedBooks: 0
                };

                // Check if member code already exists
                if (this.members.some(member => member.code === newMember.code)) {
                    this.showToast('âŒ Kode anggota sudah terdaftar!', 'error');
                    return;
                }

                this.members.push(newMember);
                this.saveData();
                this.loadMembers();
                this.loadBorrowForm();
                this.updateStatistics();

                // Reset form
                form.reset();
                document.getElementById('memberJoinDate').valueAsDate = new Date();

                this.showToast(`âœ… Anggota "${newMember.name}" berhasil ditambahkan!`, 'success');
            }

            toggleMemberStatus(memberId) {
                const member = this.members.find(m => m.id === memberId);
                if (!member) return;

                // Check if member has borrowed books
                const borrowedBooks = this.transactions.filter(t =>
                    t.memberId === memberId && !t.returned
                ).length;

                if (borrowedBooks > 0 && member.status === 'active') {
                    this.showToast('âŒ Tidak bisa menonaktifkan anggota yang masih meminjam buku!', 'error');
                    return;
                }

                member.status = member.status === 'active' ? 'inactive' : 'active';
                this.saveData();
                this.loadMembers();
                this.loadBorrowForm();
                this.updateStatistics();

                this.showToast(`âœ… Anggota "${member.name}" berhasil ${member.status === 'active' ? 'diaktifkan' : 'dinonaktifkan'}!`, 'success');
            }

            searchBooks(query) {
                this.loadBooks(); // Reload with search filter
            }

            searchBorrowHistory(query) {
                this.loadBorrowHistory(); // Reload with search filter
            }

            searchMembers(query) {
                this.loadMembers(); // Reload with search filter
            }

            applyFilters() {
                this.loadBooks();
            }

            resetFilters() {
                document.getElementById('bookSearch').value = '';
                document.getElementById('filterCategory').value = '';
                document.getElementById('filterStatus').value = '';
                document.getElementById('sortBooks').value = 'title';
                this.loadBooks();
            }

            showTransactionDetail(transactionId) {
                const transaction = this.transactions.find(t => t.id === transactionId);
                if (!transaction) return;

                const book = this.books.find(b => b.id == transaction.bookId);
                const member = this.members.find(m => m.id == transaction.memberId);

                let detail = `
                    <strong>Kode Transaksi:</strong> ${transaction.code}<br>
                    <strong>Buku:</strong> ${book?.title || 'Unknown'} (${book?.code || 'N/A'})<br>
                    <strong>Peminjam:</strong> ${member?.name || 'Unknown'}<br>
                    <strong>Tanggal Pinjam:</strong> ${this.formatDate(transaction.borrowDate)}<br>
                    <strong>Jatuh Tempo:</strong> ${this.formatDate(transaction.dueDate)}<br>
                    <strong>Status:</strong> ${transaction.returned ? 'Dikembalikan' : 'Dipinjam'}<br>
                `;

                if (transaction.returned) {
                    detail += `<strong>Tanggal Kembali:</strong> ${this.formatDate(transaction.returnDate)}<br>`;
                    if (transaction.fine > 0) {
                        detail += `<strong>Denda:</strong> Rp ${transaction.fine.toLocaleString()}<br>`;
                    }
                }

                if (transaction.note) {
                    detail += `<strong>Catatan:</strong> ${transaction.note}<br>`;
                }

                alert(detail);
            }

            scanBarcode() {
                // Simulate barcode scanning
                const availableBooks = this.books.filter(b => b.available > 0);
                if (availableBooks.length === 0) {
                    this.showToast('âŒ Tidak ada buku tersedia untuk dipindai!', 'error');
                    return;
                }

                const randomBook = availableBooks[Math.floor(Math.random() * availableBooks.length)];
                document.getElementById('returnBarcode').value = randomBook.code;
                this.showToast(`ðŸ“– Buku "${randomBook.title}" berhasil dipindai!`, 'info');
            }

            updateStatistics() {
                const totalBooks = this.books.reduce((sum, book) => sum + book.stock, 0);
                const availableBooks = this.books.reduce((sum, book) => sum + book.available, 0);
                const borrowedBooks = totalBooks - availableBooks;
                const activeMembers = this.members.filter(m => m.status === 'active').length;
                const activeBorrows = this.transactions.filter(t => !t.returned).length;
                const overdueBooks = this.transactions.filter(t =>
                    !t.returned && new Date(t.dueDate) < new Date()
                ).length;

                document.getElementById('totalBooks').textContent = totalBooks;
                document.getElementById('availableBooks').textContent = availableBooks;
                document.getElementById('borrowedBooks').textContent = borrowedBooks;
                document.getElementById('activeMembers').textContent = activeMembers;

                document.getElementById('dashboardBadge').textContent = activeBorrows > 0 ? `${activeBorrows} aktif` : '0';
                document.getElementById('booksBadge').textContent = this.books.length;
                document.getElementById('borrowBadge').textContent = activeBorrows;
                document.getElementById('returnBadge').textContent = overdueBooks;
                document.getElementById('membersBadge').textContent = activeMembers;

                this.updateQuickStats();
            }

            updateQuickStats() {
                const totalBooks = this.books.reduce((sum, book) => sum + book.stock, 0);
                const availableBooks = this.books.reduce((sum, book) => sum + book.available, 0);
                const activeMembers = this.members.filter(m => m.status === 'active').length;

                document.getElementById('quickTotalBooks').textContent = totalBooks;
                document.getElementById('quickAvailableBooks').textContent = availableBooks;
                document.getElementById('quickActiveMembers').textContent = activeMembers;
            }

            refreshData() {
                this.loadBooks();
                this.loadBorrowHistory();
                this.loadRecentTransactions();
                this.loadDueBooks();
                this.loadMembers();
                this.updateStatistics();
                this.loadCharts();

                this.showToast('ðŸ”„ Data diperbarui!', 'info');
            }

            saveData() {
                localStorage.setItem('libraryBooks', JSON.stringify(this.books));
                localStorage.setItem('libraryMembers', JSON.stringify(this.members));
                localStorage.setItem('libraryTransactions', JSON.stringify(this.transactions));
            }

            setCurrentDate() {
                const today = new Date().toISOString().split('T')[0];
                const nextWeek = new Date();
                nextWeek.setDate(nextWeek.getDate() + 7);
                const nextWeekStr = nextWeek.toISOString().split('T')[0];

                document.getElementById('borrowDate').value = today;
                document.getElementById('returnDate').value = nextWeekStr;
            }

            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('id-ID', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
            }

            showToast(message, type = 'info') {
                const toastContainer = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;

                const icons = {
                    'success': 'fas fa-check-circle',
                    'error': 'fas fa-exclamation-circle',
                    'info': 'fas fa-info-circle'
                };

                toast.innerHTML = `
                    <div class="toast-icon">
                        <i class="${icons[type] || icons.info}"></i>
                    </div>
                    <div>
                        <div class="fw-bold mb-1">${type === 'success' ? 'Berhasil' : type === 'error' ? 'Error' : 'Info'}</div>
                        <div class="small">${message}</div>
                    </div>
                `;

                toastContainer.appendChild(toast);

                // Auto remove after 5 seconds
                setTimeout(() => {
                    toast.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }, 5000);
            }
        }

        // Initialize the library system
        const library = new LibrarySystem();

        // Make library available globally for button onclick events
        window.library = library;
    </script>
</body>

</html>