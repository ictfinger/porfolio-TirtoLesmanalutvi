<!DOCTYPE html>
<html lang="id" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ“š Digital Library Pro | Sistem Manajemen Perpustakaan</title>

    <!-- SEO Meta Tags -->
    <meta name="description"
        content="Sistem manajemen perpustakaan digital modern dengan fitur lengkap untuk pengelolaan buku, peminjaman, dan statistik.">
    <meta name="keywords" content="perpustakaan digital, manajemen buku, sistem peminjaman, perpustakaan online">
    <meta name="author" content="Digital Library Pro">

    <!-- Bootstrap 5.3 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #7209b7;
            --success-color: #4cc9f0;
            --warning-color: #f72585;
            --dark-bg: #0a0a0a;
            --card-bg: #121212;
            --sidebar-bg: #1a1a1a;
            --gradient-primary: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            --gradient-secondary: linear-gradient(135deg, #7209b7 0%, #3a0ca3 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--dark-bg);
            color: #fff;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            height: 100vh;
            background: var(--sidebar-bg);
            position: fixed;
            left: 0;
            top: 0;
            z-index: 1000;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 2rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: var(--gradient-primary);
            position: relative;
            overflow: hidden;
        }

        .sidebar-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        .sidebar-brand {
            display: flex;
            align-items: center;
            gap: 1rem;
            position: relative;
            z-index: 2;
        }

        .sidebar-brand i {
            font-size: 2rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.75rem;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .sidebar-brand h3 {
            font-weight: 800;
            margin: 0;
            font-size: 1.5rem;
            background: linear-gradient(135deg, #fff 0%, #cbd5e1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-link {
            padding: 1rem 1.5rem;
            color: #94a3b8;
            display: flex;
            align-items: center;
            gap: 1rem;
            font-weight: 500;
            border-radius: 12px;
            margin: 0.5rem 1rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            background: var(--gradient-primary);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .nav-link:hover,
        .nav-link.active {
            background: rgba(67, 97, 238, 0.1);
            color: #fff;
            transform: translateX(5px);
        }

        .nav-link.active::before {
            transform: translateX(0);
        }

        .nav-link i {
            font-size: 1.25rem;
            width: 24px;
        }

        .nav-badge {
            margin-left: auto;
            background: var(--gradient-primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            padding: 2rem;
            min-height: 100vh;
        }

        /* Header */
        .main-header {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title h1 {
            font-weight: 800;
            font-size: 1.8rem;
            margin: 0;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-title p {
            color: #94a3b8;
            margin: 0;
            font-size: 0.95rem;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
            box-shadow: 0 10px 30px rgba(67, 97, 238, 0.2);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin-bottom: 1rem;
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }

        .stat-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #94a3b8;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .stat-change {
            font-size: 0.85rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
        }

        .stat-up {
            background: rgba(76, 201, 240, 0.1);
            color: var(--success-color);
        }

        .stat-down {
            background: rgba(247, 37, 133, 0.1);
            color: var(--warning-color);
        }

        /* Table Card */
        .table-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .card-title i {
            color: var(--primary-color);
        }

        /* Table Styling */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            color: #e2e8f0;
        }

        .data-table th {
            background: rgba(67, 97, 238, 0.1);
            color: #cbd5e1;
            font-weight: 600;
            padding: 1rem 1.25rem;
            text-align: left;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-table td {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .data-table tbody tr {
            transition: all 0.2s ease;
        }

        .data-table tbody tr:hover {
            background: rgba(67, 97, 238, 0.05);
            transform: translateX(5px);
        }

        .data-table tbody tr:last-child td {
            border-bottom: none;
        }

        .status-badge {
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-available {
            background: rgba(76, 201, 240, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(76, 201, 240, 0.3);
        }

        .status-borrowed {
            background: rgba(247, 37, 133, 0.1);
            color: var(--warning-color);
            border: 1px solid rgba(247, 37, 133, 0.3);
        }

        .status-overdue {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .btn-icon:hover {
            transform: translateY(-2px);
        }

        .btn-edit {
            background: rgba(76, 201, 240, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(76, 201, 240, 0.3);
        }

        .btn-edit:hover {
            background: rgba(76, 201, 240, 0.2);
        }

        .btn-delete {
            background: rgba(247, 37, 133, 0.1);
            color: var(--warning-color);
            border: 1px solid rgba(247, 37, 133, 0.3);
        }

        .btn-delete:hover {
            background: rgba(247, 37, 133, 0.2);
        }

        .btn-borrow {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
            border: 1px solid rgba(67, 97, 238, 0.3);
        }

        .btn-borrow:hover {
            background: rgba(67, 97, 238, 0.2);
        }

        /* Modal */
        .modal-content {
            background: var(--card-bg);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1.5rem 2rem;
            background: var(--gradient-primary);
            border-radius: 20px 20px 0 0;
        }

        .modal-title {
            color: white;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-footer {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1.5rem 2rem;
        }

        /* Form Styling */
        .form-label {
            color: #cbd5e1;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .form-control {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--primary-color);
            color: white;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .form-control::placeholder {
            color: #64748b;
        }

        .form-control:disabled {
            background: rgba(255, 255, 255, 0.03);
            color: #64748b;
        }

        /* Buttons */
        .btn-primary {
            background: var(--gradient-primary);
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(67, 97, 238, 0.4);
        }

        .btn-outline-light {
            border-radius: 12px;
            padding: 0.75rem 2rem;
            font-weight: 600;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .btn-outline-light:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* Search Bar */
        .search-container {
            position: relative;
            max-width: 400px;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 3rem;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 0.95rem;
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
            font-size: 1.1rem;
        }

        /* Charts */
        .chart-container {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 2rem;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .chart-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin: 0;
        }

        /* Loading Animation */
        .loading {
            position: relative;
            overflow: hidden;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% {
                left: -100%;
            }

            100% {
                left: 100%;
            }
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }
        }

        /* Animation Classes */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Toast Notification */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: slideInRight 0.3s ease;
            min-width: 300px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .toast-success {
            background: rgba(76, 201, 240, 0.1);
            border-color: rgba(76, 201, 240, 0.3);
        }

        .toast-success .toast-icon {
            background: rgba(76, 201, 240, 0.2);
            color: var(--success-color);
        }

        .toast-error {
            background: rgba(247, 37, 133, 0.1);
            border-color: rgba(247, 37, 133, 0.3);
        }

        .toast-error .toast-icon {
            background: rgba(247, 37, 133, 0.2);
            color: var(--warning-color);
        }

        .toast-info {
            background: rgba(67, 97, 238, 0.1);
            border-color: rgba(67, 97, 238, 0.3);
        }

        .toast-info .toast-icon {
            background: rgba(67, 97, 238, 0.2);
            color: var(--primary-color);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #64748b;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .empty-state h4 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: #94a3b8;
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-brand">
                <i class="fas fa-book"></i>
                <div>
                    <h3>Digital Library</h3>
                    <p class="text-light mb-0 small opacity-75">Management System</p>
                </div>
            </div>
        </div>

        <nav class="nav flex-column mt-3">
            <a class="nav-link active" href="#dashboard" data-section="dashboard">
                <i class="fas fa-home"></i>
                Dashboard
                <span class="nav-badge" id="dashboardBadge">New</span>
            </a>
            <a class="nav-link" href="#books" data-section="books">
                <i class="fas fa-book"></i>
                Manajemen Buku
                <span class="nav-badge" id="booksBadge">0</span>
            </a>
            <a class="nav-link" href="#borrow" data-section="borrow">
                <i class="fas fa-sign-out-alt"></i>
                Peminjaman
                <span class="nav-badge" id="borrowBadge">0</span>
            </a>
            <a class="nav-link" href="#return" data-section="return">
                <i class="fas fa-sign-in-alt"></i>
                Pengembalian
                <span class="nav-badge" id="returnBadge">0</span>
            </a>
            <a class="nav-link" href="#members" data-section="members">
                <i class="fas fa-users"></i>
                Anggota
                <span class="nav-badge" id="membersBadge">0</span>
            </a>
            <a class="nav-link" href="#reports" data-section="reports">
                <i class="fas fa-chart-bar"></i>
                Laporan
            </a>
            <a class="nav-link" href="#settings" data-section="settings">
                <i class="fas fa-cog"></i>
                Pengaturan
            </a>
        </nav>

        <div class="mt-auto p-4 border-top border-dark">
            <div class="d-flex align-items-center">
                <div class="flex-shrink-0">
                    <img src="https://ui-avatars.com/api/?name=Admin&background=4361ee&color=fff" alt="Admin"
                        class="rounded-circle" width="40" height="40">
                </div>
                <div class="flex-grow-1 ms-3">
                    <h6 class="mb-0">Administrator</h6>
                    <small class="text-muted">Super Admin</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="main-header">
            <div class="header-title">
                <h1 id="pageTitle">ðŸ“Š Dashboard</h1>
                <p id="pageDescription">Selamat datang di sistem manajemen perpustakaan digital</p>
            </div>
            <div class="header-actions d-flex gap-3">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addBookModal">
                    <i class="fas fa-plus me-2"></i>Tambah Buku
                </button>
                <button class="btn btn-outline-light" id="refreshBtn">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div id="dashboard" class="section-content active">
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="stat-content">
                        <div>
                            <div class="stat-number" id="totalBooks">0</div>
                            <div class="stat-label">Total Buku</div>
                        </div>
                        <span class="stat-change stat-up">+12%</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <div class="stat-content">
                        <div>
                            <div class="stat-number" id="availableBooks">0</div>
                            <div class="stat-label">Buku Tersedia</div>
                        </div>
                        <span class="stat-change stat-up">+8%</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-handshake"></i>
                    </div>
                    <div class="stat-content">
                        <div>
                            <div class="stat-number" id="borrowedBooks">0</div>
                            <div class="stat-label">Sedang Dipinjam</div>
                        </div>
                        <span class="stat-change stat-down">-3%</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <div>
                            <div class="stat-number" id="activeMembers">0</div>
                            <div class="stat-label">Anggota Aktif</div>
                        </div>
                        <span class="stat-change stat-up">+15%</span>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="row">
                <div class="col-lg-8">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3 class="chart-title">ðŸ“ˆ Statistik Peminjaman Bulanan</h3>
                            <select class="form-select form-select-sm" style="width: auto;" id="chartPeriod">
                                <option value="monthly">Bulan Ini</option>
                                <option value="quarterly">3 Bulan Terakhir</option>
                                <option value="yearly">Tahun Ini</option>
                            </select>
                        </div>
                        <canvas id="borrowingChart"></canvas>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="chart-container">
                        <h3 class="chart-title mb-4">ðŸ“Š Kategori Buku</h3>
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Recent Transactions -->
            <div class="table-card">
                <div class="card-header">
                    <h4 class="card-title">
                        <i class="fas fa-history"></i>Transaksi Terbaru
                    </h4>
                    <a href="#borrow" class="btn btn-sm btn-outline-light">Lihat Semua</a>
                </div>
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Anggota</th>
                                <th>Buku</th>
                                <th>Jenis</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="recentTransactions">
                            <!-- Data akan dimuat secara dinamis -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Books Management Content -->
        <div id="books" class="section-content">
            <div class="table-card">
                <div class="card-header">
                    <h4 class="card-title">
                        <i class="fas fa-books"></i>Daftar Buku
                    </h4>
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" id="bookSearch" placeholder="Cari buku...">
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Kode</th>
                                <th>Judul</th>
                                <th>Pengarang</th>
                                <th>Kategori</th>
                                <th>Tahun</th>
                                <th>Stok</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="booksTable">
                            <!-- Data buku akan dimuat di sini -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Borrow Content -->
        <div id="borrow" class="section-content">
            <div class="row">
                <div class="col-lg-5">
                    <div class="table-card">
                        <div class="card-header">
                            <h4 class="card-title">
                                <i class="fas fa-handshake"></i>Form Peminjaman
                            </h4>
                        </div>
                        <form id="borrowForm" class="p-3">
                            <div class="mb-3">
                                <label class="form-label">Pilih Buku</label>
                                <select class="form-control" id="borrowBookSelect" required>
                                    <option value="">-- Pilih Buku --</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Pilih Anggota</label>
                                <select class="form-control" id="borrowMemberSelect" required>
                                    <option value="">-- Pilih Anggota --</option>
                                </select>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Tanggal Pinjam</label>
                                        <input type="date" class="form-control" id="borrowDate" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Tanggal Kembali</label>
                                        <input type="date" class="form-control" id="returnDate" required>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-check me-2"></i>Proses Peminjaman
                            </button>
                        </form>
                    </div>
                </div>
                <div class="col-lg-7">
                    <div class="table-card">
                        <div class="card-header">
                            <h4 class="card-title">
                                <i class="fas fa-list"></i>Riwayat Peminjaman
                            </h4>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Kode</th>
                                        <th>Anggota</th>
                                        <th>Buku</th>
                                        <th>Pinjam</th>
                                        <th>Kembali</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="borrowHistory">
                                    <!-- Data peminjaman akan dimuat di sini -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast Container -->
        <div class="toast-container" id="toastContainer"></div>
    </div>

    <!-- Add Book Modal -->
    <div class="modal fade" id="addBookModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-plus-circle me-2"></i>Tambah Buku Baru
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form id="addBookForm">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Kode Buku *</label>
                                    <input type="text" class="form-control" id="bookCode" required
                                        placeholder="LIB-001">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">ISBN</label>
                                    <input type="text" class="form-control" id="bookISBN"
                                        placeholder="978-3-16-148410-0">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Judul Buku *</label>
                            <input type="text" class="form-control" id="bookTitle" required
                                placeholder="Judul lengkap buku">
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Pengarang *</label>
                                    <input type="text" class="form-control" id="bookAuthor" required
                                        placeholder="Nama pengarang">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Penerbit</label>
                                    <input type="text" class="form-control" id="bookPublisher"
                                        placeholder="Nama penerbit">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Kategori *</label>
                                    <select class="form-control" id="bookCategory" required>
                                        <option value="">Pilih Kategori</option>
                                        <option value="Fiksi">Fiksi</option>
                                        <option value="Non-Fiksi">Non-Fiksi</option>
                                        <option value="Teknologi">Teknologi</option>
                                        <option value="Sains">Sains</option>
                                        <option value="Sejarah">Sejarah</option>
                                        <option value="Sastra">Sastra</option>
                                        <option value="Pendidikan">Pendidikan</option>
                                        <option value="Agama">Agama</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Tahun Terbit *</label>
                                    <input type="number" class="form-control" id="bookYear" required min="1900"
                                        max="2024" placeholder="2024">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Jumlah Stok *</label>
                                    <input type="number" class="form-control" id="bookStock" required min="1" value="1">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Deskripsi</label>
                            <textarea class="form-control" id="bookDescription" rows="3"
                                placeholder="Deskripsi singkat tentang buku"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="submit" class="btn btn-primary">Simpan Buku</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Book Modal -->
    <div class="modal fade" id="editBookModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-edit me-2"></i>Edit Buku
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form id="editBookForm">
                    <div class="modal-body">
                        <input type="hidden" id="editBookId">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Kode Buku *</label>
                                    <input type="text" class="form-control" id="editBookCode" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">ISBN</label>
                                    <input type="text" class="form-control" id="editBookISBN">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Judul Buku *</label>
                            <input type="text" class="form-control" id="editBookTitle" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Pengarang *</label>
                                    <input type="text" class="form-control" id="editBookAuthor" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Penerbit</label>
                                    <input type="text" class="form-control" id="editBookPublisher">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Kategori *</label>
                                    <select class="form-control" id="editBookCategory" required>
                                        <option value="Fiksi">Fiksi</option>
                                        <option value="Non-Fiksi">Non-Fiksi</option>
                                        <option value="Teknologi">Teknologi</option>
                                        <option value="Sains">Sains</option>
                                        <option value="Sejarah">Sejarah</option>
                                        <option value="Sastra">Sastra</option>
                                        <option value="Pendidikan">Pendidikan</option>
                                        <option value="Agama">Agama</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Tahun Terbit *</label>
                                    <input type="number" class="form-control" id="editBookYear" required min="1900"
                                        max="2024">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Jumlah Stok *</label>
                                    <input type="number" class="form-control" id="editBookStock" required min="1">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Deskripsi</label>
                            <textarea class="form-control" id="editBookDescription" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="submit" class="btn btn-primary">Update Buku</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Library Management System
        class LibrarySystem {
            constructor() {
                this.books = JSON.parse(localStorage.getItem('libraryBooks')) || this.getInitialBooks();
                this.members = JSON.parse(localStorage.getItem('libraryMembers')) || this.getInitialMembers();
                this.transactions = JSON.parse(localStorage.getItem('libraryTransactions')) || [];
                this.currentEditId = null;
                this.init();
            }

            getInitialBooks() {
                return [
                    {
                        id: 1,
                        code: 'LIB-001',
                        isbn: '978-3-16-148410-0',
                        title: 'Pemrograman Web Modern',
                        author: 'John Doe',
                        publisher: 'Tech Publishing',
                        category: 'Teknologi',
                        year: 2023,
                        stock: 5,
                        available: 5,
                        description: 'Buku pemrograman web untuk pemula hingga mahir'
                    },
                    {
                        id: 2,
                        code: 'LIB-002',
                        isbn: '978-1-23-456789-0',
                        title: 'Sejarah Indonesia Modern',
                        author: 'Jane Smith',
                        publisher: 'History Press',
                        category: 'Sejarah',
                        year: 2022,
                        stock: 3,
                        available: 2,
                        description: 'Sejarah Indonesia dari masa kemerdekaan hingga sekarang'
                    },
                    {
                        id: 3,
                        code: 'LIB-003',
                        isbn: '978-0-12-345678-9',
                        title: 'Kumpulan Puisi Modern',
                        author: 'Ahmad Yani',
                        publisher: 'Sastra Publishing',
                        category: 'Sastra',
                        year: 2021,
                        stock: 4,
                        available: 4,
                        description: 'Koleksi puisi modern dari berbagai penyair ternama'
                    },
                    {
                        id: 4,
                        code: 'LIB-004',
                        isbn: '978-2-34-567890-1',
                        title: 'Data Science Untuk Pemula',
                        author: 'Dr. Data',
                        publisher: 'Science Press',
                        category: 'Sains',
                        year: 2023,
                        stock: 6,
                        available: 3,
                        description: 'Pengenalan data science untuk pemula'
                    }
                ];
            }

            getInitialMembers() {
                return [
                    {
                        id: 1,
                        code: 'MEM-001',
                        name: 'Budi Santoso',
                        email: 'budi@email.com',
                        phone: '081234567890',
                        type: 'Mahasiswa',
                        joinDate: '2024-01-15',
                        status: 'active'
                    },
                    {
                        id: 2,
                        code: 'MEM-002',
                        name: 'Siti Rahayu',
                        email: 'siti@email.com',
                        phone: '081298765432',
                        type: 'Dosen',
                        joinDate: '2024-02-20',
                        status: 'active'
                    },
                    {
                        id: 3,
                        code: 'MEM-003',
                        name: 'Ahmad Wijaya',
                        email: 'ahmad@email.com',
                        phone: '081312345678',
                        type: 'Mahasiswa',
                        joinDate: '2024-03-10',
                        status: 'active'
                    }
                ];
            }

            init() {
                this.setupEventListeners();
                this.loadDashboard();
                this.loadBooks();
                this.loadBorrowForm();
                this.loadCharts();
                this.updateStatistics();
                this.setCurrentDate();
            }

            setupEventListeners() {
                // Navigation
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = link.getAttribute('data-section');
                        this.showSection(section);

                        // Update active nav
                        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                        link.classList.add('active');
                    });
                });

                // Add Book Form
                document.getElementById('addBookForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addBook();
                });

                // Edit Book Form
                document.getElementById('editBookForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.updateBook();
                });

                // Borrow Form
                document.getElementById('borrowForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.processBorrow();
                });

                // Search
                document.getElementById('bookSearch').addEventListener('input', (e) => {
                    this.searchBooks(e.target.value);
                });

                // Refresh Button
                document.getElementById('refreshBtn').addEventListener('click', () => {
                    this.refreshData();
                });

                // Chart Period Change
                document.getElementById('chartPeriod').addEventListener('change', () => {
                    this.loadCharts();
                });
            }

            showSection(section) {
                // Hide all sections
                document.querySelectorAll('.section-content').forEach(content => {
                    content.classList.remove('active');
                });

                // Show selected section
                const sectionEl = document.getElementById(section);
                if (sectionEl) {
                    sectionEl.classList.add('active');
                }

                // Update page title
                const titles = {
                    'dashboard': { title: 'ðŸ“Š Dashboard', desc: 'Selamat datang di sistem manajemen perpustakaan digital' },
                    'books': { title: 'ðŸ“š Manajemen Buku', desc: 'Kelola koleksi buku perpustakaan' },
                    'borrow': { title: 'ðŸ“– Peminjaman Buku', desc: 'Kelola peminjaman dan pengembalian buku' },
                    'return': { title: 'ðŸ”„ Pengembalian', desc: 'Proses pengembalian buku' },
                    'members': { title: 'ðŸ‘¥ Manajemen Anggota', desc: 'Kelola data anggota perpustakaan' },
                    'reports': { title: 'ðŸ“ˆ Laporan & Statistik', desc: 'Analisis data perpustakaan' },
                    'settings': { title: 'âš™ï¸ Pengaturan Sistem', desc: 'Konfigurasi sistem perpustakaan' }
                };

                if (titles[section]) {
                    document.getElementById('pageTitle').textContent = titles[section].title;
                    document.getElementById('pageDescription').textContent = titles[section].desc;
                }

                // Load section data
                switch (section) {
                    case 'books':
                        this.loadBooks();
                        break;
                    case 'borrow':
                        this.loadBorrowHistory();
                        break;
                    case 'members':
                        this.loadMembers();
                        break;
                }
            }

            loadDashboard() {
                this.loadRecentTransactions();
                this.updateStatistics();
            }

            loadBooks() {
                const tableBody = document.getElementById('booksTable');
                if (!tableBody) return;

                if (this.books.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="8">
                                <div class="empty-state">
                                    <i class="fas fa-book"></i>
                                    <h4>Belum ada buku</h4>
                                    <p>Tambahkan buku pertama Anda</p>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                tableBody.innerHTML = this.books.map(book => `
                    <tr>
                        <td><strong>${book.code}</strong></td>
                        <td>
                            <div class="fw-bold">${book.title}</div>
                            <small class="text-muted">${book.author}</small>
                        </td>
                        <td>${book.author}</td>
                        <td><span class="badge bg-primary bg-opacity-25 text-primary">${book.category}</span></td>
                        <td>${book.year}</td>
                        <td>
                            <div class="d-flex align-items-center gap-2">
                                <div class="progress" style="width: 60px; height: 8px;">
                                    <div class="progress-bar bg-success" style="width: ${(book.available / book.stock) * 100}%"></div>
                                </div>
                                <span>${book.available}/${book.stock}</span>
                            </div>
                        </td>
                        <td>
                            <span class="status-badge ${book.available > 0 ? 'status-available' : 'status-borrowed'}">
                                <i class="fas fa-circle"></i>
                                ${book.available > 0 ? 'Tersedia' : 'Habis'}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-icon btn-edit" onclick="library.editBook(${book.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-icon btn-delete" onclick="library.deleteBook(${book.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                                ${book.available > 0 ? `
                                    <button class="btn-icon btn-borrow" onclick="library.prepareBorrow(${book.id})">
                                        <i class="fas fa-handshake"></i>
                                    </button>
                                ` : ''}
                            </div>
                        </td>
                    </tr>
                `).join('');

                // Update books badge
                document.getElementById('booksBadge').textContent = this.books.length;
            }

            loadBorrowForm() {
                const bookSelect = document.getElementById('borrowBookSelect');
                const memberSelect = document.getElementById('borrowMemberSelect');

                // Populate book select
                bookSelect.innerHTML = '<option value="">-- Pilih Buku --</option>' +
                    this.books
                        .filter(book => book.available > 0)
                        .map(book => `<option value="${book.id}">${book.code} - ${book.title}</option>`)
                        .join('');

                // Populate member select
                memberSelect.innerHTML = '<option value="">-- Pilih Anggota --</option>' +
                    this.members
                        .filter(member => member.status === 'active')
                        .map(member => `<option value="${member.id}">${member.code} - ${member.name}</option>`)
                        .join('');
            }

            loadBorrowHistory() {
                const tableBody = document.getElementById('borrowHistory');
                if (!tableBody) return;

                const recentTransactions = this.transactions.slice(-10).reverse();

                if (recentTransactions.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="7">
                                <div class="empty-state">
                                    <i class="fas fa-history"></i>
                                    <h4>Belum ada transaksi</h4>
                                    <p>Mulai proses peminjaman buku</p>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                tableBody.innerHTML = recentTransactions.map(transaction => {
                    const book = this.books.find(b => b.id == transaction.bookId);
                    const member = this.members.find(m => m.id == transaction.memberId);
                    const isOverdue = !transaction.returned && new Date(transaction.dueDate) < new Date();

                    return `
                        <tr>
                            <td>${transaction.code}</td>
                            <td>${member?.name || 'Unknown'}</td>
                            <td>${book?.title || 'Unknown'}</td>
                            <td>${this.formatDate(transaction.borrowDate)}</td>
                            <td>${this.formatDate(transaction.dueDate)}</td>
                            <td>
                                <span class="status-badge ${transaction.returned ? 'status-available' : isOverdue ? 'status-overdue' : 'status-borrowed'}">
                                    <i class="fas fa-circle"></i>
                                    ${transaction.returned ? 'Dikembalikan' : isOverdue ? 'Terlambat' : 'Dipinjam'}
                                </span>
                            </td>
                            <td>
                                ${!transaction.returned ? `
                                    <button class="btn-icon btn-edit" onclick="library.returnBook(${transaction.id})">
                                        <i class="fas fa-undo"></i>
                                    </button>
                                ` : ''}
                            </td>
                        </tr>
                    `;
                }).join('');

                // Update borrow badge
                const activeBorrows = this.transactions.filter(t => !t.returned).length;
                document.getElementById('borrowBadge').textContent = activeBorrows;
            }

            loadRecentTransactions() {
                const tableBody = document.getElementById('recentTransactions');
                if (!tableBody) return;

                const recent = this.transactions.slice(-5).reverse();

                tableBody.innerHTML = recent.map(transaction => {
                    const book = this.books.find(b => b.id == transaction.bookId);
                    const member = this.members.find(m => m.id == transaction.memberId);

                    return `
                        <tr>
                            <td>${this.formatDate(transaction.borrowDate)}</td>
                            <td>${member?.name || 'Unknown'}</td>
                            <td>${book?.title || 'Unknown'}</td>
                            <td>Peminjaman</td>
                            <td>
                                <span class="status-badge ${transaction.returned ? 'status-available' : 'status-borrowed'}">
                                    ${transaction.returned ? 'Selesai' : 'Aktif'}
                                </span>
                            </td>
                            <td>
                                <button class="btn-icon btn-edit" onclick="library.showTransaction(${transaction.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            loadCharts() {
                // Borrowing Chart
                const borrowingCtx = document.getElementById('borrowingChart').getContext('2d');

                // Sample data - in real app, this would come from database
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
                const borrowData = [65, 59, 80, 81, 56, 55, 40, 45, 60, 75, 80, 90];
                const returnData = [60, 55, 75, 79, 52, 50, 38, 42, 58, 70, 78, 85];

                new Chart(borrowingCtx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [
                            {
                                label: 'Peminjaman',
                                data: borrowData,
                                borderColor: '#4361ee',
                                backgroundColor: 'rgba(67, 97, 238, 0.1)',
                                tension: 0.4,
                                fill: true
                            },
                            {
                                label: 'Pengembalian',
                                data: returnData,
                                borderColor: '#4cc9f0',
                                backgroundColor: 'rgba(76, 201, 240, 0.1)',
                                tension: 0.4,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#e2e8f0'
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: '#94a3b8'
                                }
                            },
                            y: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.1)'
                                },
                                ticks: {
                                    color: '#94a3b8'
                                }
                            }
                        }
                    }
                });

                // Category Chart
                const categoryCtx = document.getElementById('categoryChart').getContext('2d');

                const categories = [...new Set(this.books.map(book => book.category))];
                const categoryData = categories.map(category =>
                    this.books.filter(book => book.category === category).length
                );

                new Chart(categoryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: categories,
                        datasets: [{
                            data: categoryData,
                            backgroundColor: [
                                '#4361ee',
                                '#3a0ca3',
                                '#7209b7',
                                '#4cc9f0',
                                '#f72585',
                                '#4895ef'
                            ],
                            borderWidth: 2,
                            borderColor: '#121212'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: '#e2e8f0',
                                    padding: 20
                                }
                            }
                        }
                    }
                });
            }

            addBook() {
                const form = document.getElementById('addBookForm');
                const formData = new FormData(form);

                const newBook = {
                    id: Date.now(),
                    code: formData.get('bookCode'),
                    isbn: formData.get('bookISBN'),
                    title: formData.get('bookTitle'),
                    author: formData.get('bookAuthor'),
                    publisher: formData.get('bookPublisher'),
                    category: formData.get('bookCategory'),
                    year: parseInt(formData.get('bookYear')),
                    stock: parseInt(formData.get('bookStock')),
                    available: parseInt(formData.get('bookStock')),
                    description: formData.get('bookDescription')
                };

                // Check if book code already exists
                if (this.books.some(book => book.code === newBook.code)) {
                    this.showToast('Kode buku sudah terdaftar!', 'error');
                    return;
                }

                this.books.push(newBook);
                this.saveData();
                this.loadBooks();
                this.updateStatistics();
                this.loadCharts();
                this.loadBorrowForm();

                // Close modal and reset form
                bootstrap.Modal.getInstance(document.getElementById('addBookModal')).hide();
                form.reset();

                this.showToast(`Buku "${newBook.title}" berhasil ditambahkan!`, 'success');
            }

            editBook(bookId) {
                const book = this.books.find(b => b.id === bookId);
                if (!book) return;

                this.currentEditId = bookId;

                // Fill edit form
                document.getElementById('editBookId').value = book.id;
                document.getElementById('editBookCode').value = book.code;
                document.getElementById('editBookISBN').value = book.isbn || '';
                document.getElementById('editBookTitle').value = book.title;
                document.getElementById('editBookAuthor').value = book.author;
                document.getElementById('editBookPublisher').value = book.publisher || '';
                document.getElementById('editBookCategory').value = book.category;
                document.getElementById('editBookYear').value = book.year;
                document.getElementById('editBookStock').value = book.stock;
                document.getElementById('editBookDescription').value = book.description || '';

                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('editBookModal'));
                modal.show();
            }

            updateBook() {
                const bookId = parseInt(document.getElementById('editBookId').value);
                const bookIndex = this.books.findIndex(b => b.id === bookId);

                if (bookIndex === -1) return;

                const oldBook = this.books[bookIndex];
                const newStock = parseInt(document.getElementById('editBookStock').value);
                const stockDifference = newStock - oldBook.stock;

                this.books[bookIndex] = {
                    ...oldBook,
                    code: document.getElementById('editBookCode').value,
                    isbn: document.getElementById('editBookISBN').value,
                    title: document.getElementById('editBookTitle').value,
                    author: document.getElementById('editBookAuthor').value,
                    publisher: document.getElementById('editBookPublisher').value,
                    category: document.getElementById('editBookCategory').value,
                    year: parseInt(document.getElementById('editBookYear').value),
                    stock: newStock,
                    available: Math.max(0, oldBook.available + stockDifference),
                    description: document.getElementById('editBookDescription').value
                };

                this.saveData();
                this.loadBooks();
                this.updateStatistics();
                this.loadCharts();
                this.loadBorrowForm();

                bootstrap.Modal.getInstance(document.getElementById('editBookModal')).hide();
                this.showToast(`Buku "${this.books[bookIndex].title}" berhasil diperbarui!`, 'success');
            }

            deleteBook(bookId) {
                if (!confirm('Apakah Anda yakin ingin menghapus buku ini?')) return;

                const book = this.books.find(b => b.id === bookId);
                if (!book) return;

                // Check if book is currently borrowed
                const activeBorrows = this.transactions.filter(t =>
                    t.bookId === bookId && !t.returned
                );

                if (activeBorrows.length > 0) {
                    this.showToast('Tidak bisa menghapus buku yang sedang dipinjam!', 'error');
                    return;
                }

                this.books = this.books.filter(b => b.id !== bookId);
                this.saveData();
                this.loadBooks();
                this.updateStatistics();
                this.loadCharts();
                this.loadBorrowForm();

                this.showToast('Buku berhasil dihapus!', 'success');
            }

            prepareBorrow(bookId) {
                const book = this.books.find(b => b.id === bookId);
                if (!book || book.available <= 0) return;

                // Switch to borrow section
                this.showSection('borrow');

                // Set book in select
                setTimeout(() => {
                    document.getElementById('borrowBookSelect').value = bookId;
                }, 100);
            }

            processBorrow() {
                const bookId = parseInt(document.getElementById('borrowBookSelect').value);
                const memberId = parseInt(document.getElementById('borrowMemberSelect').value);
                const borrowDate = document.getElementById('borrowDate').value;
                const dueDate = document.getElementById('returnDate').value;

                const book = this.books.find(b => b.id === bookId);
                const member = this.members.find(m => m.id === memberId);

                if (!book || !member) {
                    this.showToast('Data tidak valid!', 'error');
                    return;
                }

                if (book.available <= 0) {
                    this.showToast('Buku tidak tersedia!', 'error');
                    return;
                }

                // Check if member has overdue books
                const memberOverdue = this.transactions.filter(t =>
                    t.memberId === memberId &&
                    !t.returned &&
                    new Date(t.dueDate) < new Date()
                );

                if (memberOverdue.length > 0) {
                    this.showToast('Anggota memiliki buku yang terlambat dikembalikan!', 'error');
                    return;
                }

                // Update book availability
                book.available -= 1;

                // Create transaction
                const transaction = {
                    id: Date.now(),
                    code: `TRX-${Date.now().toString().slice(-6)}`,
                    bookId: bookId,
                    memberId: memberId,
                    borrowDate: borrowDate,
                    dueDate: dueDate,
                    returned: false,
                    returnDate: null
                };

                this.transactions.push(transaction);

                this.saveData();
                this.loadBooks();
                this.loadBorrowHistory();
                this.loadRecentTransactions();
                this.updateStatistics();
                this.loadBorrowForm();

                // Reset form
                document.getElementById('borrowForm').reset();
                this.setCurrentDate();

                this.showToast(`Buku "${book.title}" berhasil dipinjam oleh ${member.name}!`, 'success');
            }

            returnBook(transactionId) {
                const transactionIndex = this.transactions.findIndex(t => t.id === transactionId);
                if (transactionIndex === -1) return;

                this.transactions[transactionIndex].returned = true;
                this.transactions[transactionIndex].returnDate = new Date().toISOString().split('T')[0];

                const bookId = this.transactions[transactionIndex].bookId;
                const bookIndex = this.books.findIndex(b => b.id === bookId);

                if (bookIndex !== -1) {
                    this.books[bookIndex].available += 1;
                }

                this.saveData();
                this.loadBooks();
                this.loadBorrowHistory();
                this.loadRecentTransactions();
                this.updateStatistics();

                this.showToast('Buku berhasil dikembalikan!', 'success');
            }

            searchBooks(query) {
                const tableBody = document.getElementById('booksTable');
                if (!tableBody) return;

                const filteredBooks = this.books.filter(book => {
                    const searchLower = query.toLowerCase();
                    return (
                        book.code.toLowerCase().includes(searchLower) ||
                        book.title.toLowerCase().includes(searchLower) ||
                        book.author.toLowerCase().includes(searchLower) ||
                        book.category.toLowerCase().includes(searchLower) ||
                        book.publisher?.toLowerCase().includes(searchLower)
                    );
                });

                if (filteredBooks.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="8">
                                <div class="empty-state">
                                    <i class="fas fa-search"></i>
                                    <h4>Tidak ditemukan</h4>
                                    <p>Tidak ada buku yang sesuai dengan pencarian</p>
                                </div>
                            </td>
                        </tr>
                    `;
                    return;
                }

                tableBody.innerHTML = filteredBooks.map(book => `
                    <tr>
                        <td><strong>${book.code}</strong></td>
                        <td>
                            <div class="fw-bold">${book.title}</div>
                            <small class="text-muted">${book.author}</small>
                        </td>
                        <td>${book.author}</td>
                        <td><span class="badge bg-primary bg-opacity-25 text-primary">${book.category}</span></td>
                        <td>${book.year}</td>
                        <td>
                            <div class="d-flex align-items-center gap-2">
                                <div class="progress" style="width: 60px; height: 8px;">
                                    <div class="progress-bar bg-success" style="width: ${(book.available / book.stock) * 100}%"></div>
                                </div>
                                <span>${book.available}/${book.stock}</span>
                            </div>
                        </td>
                        <td>
                            <span class="status-badge ${book.available > 0 ? 'status-available' : 'status-borrowed'}">
                                <i class="fas fa-circle"></i>
                                ${book.available > 0 ? 'Tersedia' : 'Habis'}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-icon btn-edit" onclick="library.editBook(${book.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-icon btn-delete" onclick="library.deleteBook(${book.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            updateStatistics() {
                const totalBooks = this.books.reduce((sum, book) => sum + book.stock, 0);
                const availableBooks = this.books.reduce((sum, book) => sum + book.available, 0);
                const borrowedBooks = totalBooks - availableBooks;
                const activeMembers = this.members.filter(m => m.status === 'active').length;
                const activeBorrows = this.transactions.filter(t => !t.returned).length;

                document.getElementById('totalBooks').textContent = totalBooks;
                document.getElementById('availableBooks').textContent = availableBooks;
                document.getElementById('borrowedBooks').textContent = borrowedBooks;
                document.getElementById('activeMembers').textContent = activeMembers;

                document.getElementById('dashboardBadge').textContent = activeBorrows > 0 ? `${activeBorrows} aktif` : 'New';
                document.getElementById('booksBadge').textContent = this.books.length;
                document.getElementById('borrowBadge').textContent = activeBorrows;
                document.getElementById('membersBadge').textContent = activeMembers;
            }

            refreshData() {
                this.loadBooks();
                this.loadBorrowHistory();
                this.loadRecentTransactions();
                this.updateStatistics();
                this.loadCharts();

                this.showToast('Data diperbarui!', 'info');
            }

            saveData() {
                localStorage.setItem('libraryBooks', JSON.stringify(this.books));
                localStorage.setItem('libraryMembers', JSON.stringify(this.members));
                localStorage.setItem('libraryTransactions', JSON.stringify(this.transactions));
            }

            setCurrentDate() {
                const today = new Date().toISOString().split('T')[0];
                const nextWeek = new Date();
                nextWeek.setDate(nextWeek.getDate() + 7);
                const nextWeekStr = nextWeek.toISOString().split('T')[0];

                document.getElementById('borrowDate').value = today;
                document.getElementById('returnDate').value = nextWeekStr;
            }

            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('id-ID', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
            }

            showToast(message, type = 'info') {
                const toastContainer = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;

                const icons = {
                    'success': 'fas fa-check-circle',
                    'error': 'fas fa-exclamation-circle',
                    'info': 'fas fa-info-circle'
                };

                toast.innerHTML = `
                    <div class="toast-icon">
                        <i class="${icons[type] || icons.info}"></i>
                    </div>
                    <div>
                        <div class="fw-bold mb-1">${type === 'success' ? 'Berhasil' : type === 'error' ? 'Error' : 'Info'}</div>
                        <div class="small">${message}</div>
                    </div>
                `;

                toastContainer.appendChild(toast);

                // Auto remove after 5 seconds
                setTimeout(() => {
                    toast.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }, 5000);
            }

            showTransaction(transactionId) {
                // Implement transaction detail view
                this.showToast('Fitur detail transaksi akan segera tersedia!', 'info');
            }
        }

        // Initialize the library system
        const library = new LibrarySystem();

        // Make library available globally for button onclick events
        window.library = library;

        // Add slideOutRight animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>

</html>