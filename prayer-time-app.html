<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waktu Solat - Prayer Time App</title>

    <!-- SEO Meta Tags -->
    <meta name="description"
        content="Aplikasi waktu solat dengan tampilan modern dan akurat menggunakan GPS untuk seluruh Indonesia">
    <meta name="keywords" content="waktu solat, prayer time, jadwal sholat, adzan, GPS">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            max-width: 500px;
            width: 100%;
        }

        .prayer-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #667eea;
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .header .location {
            color: #666;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .location-wrapper {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .location-wrapper select {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 16px;
            font-family: 'Inter', sans-serif;
            color: #333;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .location-wrapper select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .detect-btn {
            padding: 15px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .detect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .detect-btn:active {
            transform: translateY(0);
        }

        .detect-btn i {
            font-size: 18px;
        }

        .current-time {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            color: white;
        }

        .current-time .time {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .current-time .date {
            font-size: 16px;
            opacity: 0.9;
        }

        .next-prayer {
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 15px;
        }

        .next-prayer .label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }

        .next-prayer .prayer-name {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .next-prayer .countdown {
            font-size: 18px;
            color: #764ba2;
            font-weight: 600;
        }

        .prayer-times {
            display: grid;
            gap: 12px;
        }

        .prayer-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 20px;
            background: white;
            border: 2px solid #f0f0f0;
            border-radius: 15px;
            transition: all 0.3s;
        }

        .prayer-item:hover {
            border-color: #667eea;
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .prayer-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
        }

        .prayer-name-col {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .prayer-icon {
            width: 40px;
            height: 40px;
            background: #f8f9ff;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #667eea;
        }

        .prayer-item.active .prayer-icon {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .prayer-name-col span {
            font-size: 18px;
            font-weight: 600;
        }

        .prayer-time {
            font-size: 20px;
            font-weight: 700;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading i {
            font-size: 40px;
            color: #667eea;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        .footer {
            text-align: center;
            margin-top: 20px;
            color: white;
            font-size: 14px;
        }

        .footer a {
            color: white;
            text-decoration: none;
            font-weight: 600;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .gps-badge {
            display: inline-block;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
        }

        @media (max-width: 480px) {
            .prayer-card {
                padding: 25px;
            }

            .header h1 {
                font-size: 26px;
            }

            .current-time .time {
                font-size: 36px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="prayer-card">
            <div class="header">
                <h1><i class="fas fa-mosque"></i> Waktu Solat</h1>
                <div class="location">
                    <i class="fas fa-map-marker-alt"></i>
                    <span id="current-location">Memuat...</span>
                </div>
            </div>

            <div class="location-wrapper">
                <select id="city-select">
                    <option value="">Pilih Kota Manual...</option>
                    <option value="Jakarta">Jakarta</option>
                    <option value="Surabaya">Surabaya</option>
                    <option value="Bandung">Bandung</option>
                    <option value="Medan">Medan</option>
                    <option value="Semarang">Semarang</option>
                    <option value="Makassar">Makassar</option>
                    <option value="Palembang">Palembang</option>
                    <option value="Tangerang">Tangerang</option>
                    <option value="Depok">Depok</option>
                    <option value="Bekasi">Bekasi</option>
                    <option value="Yogyakarta">Yogyakarta</option>
                    <option value="Malang">Malang</option>
                </select>
                <button class="detect-btn" id="detect-location" title="Deteksi Lokasi GPS Otomatis">
                    <i class="fas fa-location-crosshairs"></i>
                </button>
            </div>

            <div class="current-time">
                <div class="time" id="current-time">00:00:00</div>
                <div class="date" id="current-date">Loading...</div>
            </div>

            <div class="next-prayer" id="next-prayer-info">
                <div class="label">Waktu Solat Berikutnya</div>
                <div class="prayer-name" id="next-prayer-name">-</div>
                <div class="countdown" id="countdown">-</div>
            </div>

            <div class="prayer-times" id="prayer-times">
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>Memuat waktu solat...</p>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Dibuat dengan <i class="fas fa-heart"></i> oleh <a href="index.html">Portfolio</a></p>
            <p style="font-size: 12px; opacity: 0.8; margin-top: 5px;">Powered by Aladhan API</p>
        </div>
    </div>

    <script>
        // City coordinates for manual selection
        const cityCoordinates = {
            'Jakarta': { lat: -6.2088, lng: 106.8456 },
            'Surabaya': { lat: -7.2575, lng: 112.7521 },
            'Bandung': { lat: -6.9175, lng: 107.6191 },
            'Medan': { lat: 3.5952, lng: 98.6722 },
            'Semarang': { lat: -6.9667, lng: 110.4167 },
            'Makassar': { lat: -5.1477, lng: 119.4327 },
            'Palembang': { lat: -2.9761, lng: 104.7754 },
            'Tangerang': { lat: -6.1783, lng: 106.6319 },
            'Depok': { lat: -6.4025, lng: 106.7942 },
            'Bekasi': { lat: -6.2383, lng: 106.9756 },
            'Yogyakarta': { lat: -7.7956, lng: 110.3695 },
            'Malang': { lat: -7.9666, lng: 112.6326 }
        };

        let prayerTimes = {};
        let isUsingGPS = false;
        let userCoordinates = null;

        // Update current time
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            const dateString = now.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

            document.getElementById('current-time').textContent = timeString;
            document.getElementById('current-date').textContent = dateString;
        }

        // Fetch prayer times from Aladhan API using coordinates
        async function fetchPrayerTimes(lat, lng) {
            try {
                const timestamp = Math.floor(Date.now() / 1000);
                const url = `https://api.aladhan.com/v1/timings/${timestamp}?latitude=${lat}&longitude=${lng}&method=20`; // Method 20 = Indonesia (Kemenag)

                console.log(`Fetching prayer times for: Lat ${lat.toFixed(4)}, Lng ${lng.toFixed(4)}`);

                const response = await fetch(url);
                const data = await response.json();

                if (data.code === 200 && data.data) {
                    const timings = data.data.timings;

                    // Extract prayer times
                    const times = {
                        'Subuh': timings.Fajr,
                        'Dzuhur': timings.Dhuhr,
                        'Ashar': timings.Asr,
                        'Maghrib': timings.Maghrib,
                        'Isya': timings.Isha
                    };

                    console.log('Prayer times fetched:', times);
                    return times;
                } else {
                    throw new Error('Failed to fetch prayer times');
                }
            } catch (error) {
                console.error('Error fetching prayer times:', error);
                // Fallback to approximate times
                return {
                    'Subuh': '04:45',
                    'Dzuhur': '12:00',
                    'Ashar': '15:15',
                    'Maghrib': '18:00',
                    'Isya': '19:15'
                };
            }
        }

        // Get next prayer
        function getNextPrayer(times) {
            const now = new Date();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();

            const prayerArray = Object.entries(times).map(([name, time]) => {
                const [hours, minutes] = time.split(':').map(Number);
                const prayerMinutes = hours * 60 + minutes;
                return { name, time, minutes: prayerMinutes };
            });

            // Find next prayer
            for (let prayer of prayerArray) {
                if (prayer.minutes > currentMinutes) {
                    return prayer;
                }
            }

            // If no prayer found, return first prayer of tomorrow
            return { ...prayerArray[0], tomorrow: true };
        }

        // Calculate countdown
        function updateCountdown() {
            if (!prayerTimes || Object.keys(prayerTimes).length === 0) return;

            const nextPrayer = getNextPrayer(prayerTimes);
            const now = new Date();

            const [hours, minutes] = nextPrayer.time.split(':').map(Number);
            let targetTime = new Date();
            targetTime.setHours(hours, minutes, 0, 0);

            if (nextPrayer.tomorrow) {
                targetTime.setDate(targetTime.getDate() + 1);
            }

            const diff = targetTime - now;
            const hoursLeft = Math.floor(diff / (1000 * 60 * 60));
            const minutesLeft = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const secondsLeft = Math.floor((diff % (1000 * 60)) / 1000);

            document.getElementById('next-prayer-name').textContent = nextPrayer.name;
            document.getElementById('countdown').textContent =
                `${hoursLeft.toString().padStart(2, '0')}:${minutesLeft.toString().padStart(2, '0')}:${secondsLeft.toString().padStart(2, '0')}`;
        }

        // Display prayer times
        function displayPrayerTimes(times) {
            const icons = {
                'Subuh': 'fa-cloud-moon',
                'Dzuhur': 'fa-sun',
                'Ashar': 'fa-cloud-sun',
                'Maghrib': 'fa-sunset',
                'Isya': 'fa-moon'
            };

            const now = new Date();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            const nextPrayer = getNextPrayer(times);

            const html = Object.entries(times).map(([name, time]) => {
                const isActive = name === nextPrayer.name && !nextPrayer.tomorrow;
                return `
                    <div class="prayer-item ${isActive ? 'active' : ''}">
                        <div class="prayer-name-col">
                            <div class="prayer-icon">
                                <i class="fas ${icons[name]}"></i>
                            </div>
                            <span>${name}</span>
                        </div>
                        <div class="prayer-time">${time}</div>
                    </div>
                `;
            }).join('');

            document.getElementById('prayer-times').innerHTML = html;
        }

        // Load prayer times for manual city selection
        async function loadPrayerTimesCity(city) {
            isUsingGPS = false;
            userCoordinates = null;

            document.getElementById('current-location').textContent = city;

            const coords = cityCoordinates[city];
            prayerTimes = await fetchPrayerTimes(coords.lat, coords.lng);
            displayPrayerTimes(prayerTimes);
            updateCountdown();
        }

        // Load prayer times using GPS coordinates
        async function loadPrayerTimesGPS(lat, lng) {
            isUsingGPS = true;
            userCoordinates = { lat, lng };

            const locationText = `GPS: ${lat.toFixed(4)}¬∞, ${lng.toFixed(4)}¬∞`;
            document.getElementById('current-location').innerHTML =
                `${locationText}<span class="gps-badge"><i class="fas fa-satellite-dish"></i> LIVE</span>`;

            prayerTimes = await fetchPrayerTimes(lat, lng);
            displayPrayerTimes(prayerTimes);
            updateCountdown();
        }

        // City selector
        document.getElementById('city-select').addEventListener('change', (e) => {
            if (e.target.value) {
                loadPrayerTimesCity(e.target.value);
            }
        });

        // Auto-detect location
        function detectLocation() {
            const btn = document.getElementById('detect-location');
            const originalHTML = btn.innerHTML;

            if (!navigator.geolocation) {
                alert('‚ùå Geolocation tidak didukung oleh browser Anda.\n\nGunakan browser modern seperti Chrome, Firefox, atau Safari.');
                return;
            }

            // Show loading state
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            btn.disabled = true;

            document.getElementById('current-location').textContent = 'Mendeteksi GPS...';

            const options = {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0
            };

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const accuracy = position.coords.accuracy;

                    console.log(`GPS detected: Lat ${lat.toFixed(4)}, Lng ${lng.toFixed(4)} (¬±${accuracy.toFixed(0)}m)`);

                    // Use GPS coordinates directly
                    loadPrayerTimesGPS(lat, lng);

                    // Clear dropdown
                    document.getElementById('city-select').value = '';

                    // Show success
                    btn.innerHTML = '<i class="fas fa-check"></i>';
                    setTimeout(() => {
                        btn.innerHTML = originalHTML;
                        btn.disabled = false;
                    }, 2000);
                },
                (error) => {
                    console.error('Geolocation error:', error);
                    let message = '';
                    let title = '‚ùå Gagal Mendeteksi Lokasi\n\n';

                    switch (error.code) {
                        case error.PERMISSION_DENIED:
                            message = 'üîí Akses lokasi ditolak.\n\n';
                            message += 'Cara mengizinkan:\n';
                            message += '1. Klik ikon üîí di address bar\n';
                            message += '2. Pilih "Izinkan" untuk lokasi\n';
                            message += '3. Refresh halaman dan coba lagi';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            message = 'üìç Informasi lokasi tidak tersedia.\n\n';
                            message += 'Pastikan GPS aktif dan browser memiliki izin.';
                            break;
                        case error.TIMEOUT:
                            message = '‚è±Ô∏è Permintaan timeout.\n\n';
                            message += 'Coba lagi atau pilih kota manual.';
                            break;
                        default:
                            message = '‚ö†Ô∏è Terjadi kesalahan.\n\n';
                            message += 'Silakan pilih kota secara manual.';
                    }

                    alert(title + message);

                    // Reset to default
                    document.getElementById('current-location').textContent = 'Jakarta';
                    document.getElementById('city-select').value = 'Jakarta';
                    loadPrayerTimesCity('Jakarta');

                    btn.innerHTML = originalHTML;
                    btn.disabled = false;
                }
            );
        }

        // Detect location button
        document.getElementById('detect-location').addEventListener('click', detectLocation);

        // Auto-detect on first load
        function autoDetectOnLoad() {
            if (navigator.geolocation) {
                console.log('Attempting auto GPS detection...');

                const options = {
                    enableHighAccuracy: true,
                    timeout: 8000,
                    maximumAge: 300000
                };

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;

                        console.log(`Auto-detected GPS: ${lat.toFixed(4)}, ${lng.toFixed(4)}`);
                        loadPrayerTimesGPS(lat, lng);
                    },
                    () => {
                        // Silently fail and use default Jakarta
                        console.log('Auto-detection failed, using Jakarta');
                        document.getElementById('current-location').textContent = 'Jakarta';
                        document.getElementById('city-select').value = 'Jakarta';
                        loadPrayerTimesCity('Jakarta');
                    },
                    options
                );
            } else {
                console.log('Geolocation not supported, using Jakarta');
                document.getElementById('current-location').textContent = 'Jakarta';
                document.getElementById('city-select').value = 'Jakarta';
                loadPrayerTimesCity('Jakarta');
            }
        }

        // Initialize
        autoDetectOnLoad();
        updateCurrentTime();

        // Update every second
        setInterval(() => {
            updateCurrentTime();
            updateCountdown();
        }, 1000);
    </script>
</body>

</html>